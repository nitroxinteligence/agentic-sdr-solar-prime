‚úÖ Usando vari√°veis de ambiente do servidor (EasyPanel)
2025-08-25 21:56:56.576 | INFO     | app.services.knowledge_service:__init__:24 | ‚úÖ KnowledgeService inicializado (vers√£o simplificada)
INFO:     Started server process [1]
INFO:     Waiting for application startup.
2025-08-25 21:56:56.600 | INFO     | app.utils.logger:log_with_emoji:75 | üöÄ Iniciando SDR IA Solar Prime v0.3
2025-08-25 21:56:56.605 | INFO     | app.integrations.redis_client:connect:35 | ‚úÖ Conectado ao Redis: redis_redis:6379
2025-08-25 21:56:56.605 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Redis pronto | Data: {'data': {'url': 'redis_redis:6379'}}
2025-08-25 21:56:57.102 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Supabase pronto
2025-08-25 21:56:57.103 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Buffer Inteligente inicializado (timeout=15.0s, max=10)
2025-08-25 21:56:57.103 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Message Buffer pronto | Data: {'data': {'timeout': '15.0s'}}
2025-08-25 21:56:57.103 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Message Splitter inicializado (max=250, smart=ativada)
2025-08-25 21:56:57.103 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Message Splitter pronto | Data: {'data': {'max_length': 250}}
2025-08-25 21:56:57.112 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üìä ConversationMonitor inicializado pronto
2025-08-25 21:56:57.113 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è ‚úÖ ConversationMonitor: Loop iniciado
2025-08-25 21:56:57.113 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Conversation Monitor pronto
2025-08-25 21:56:57.113 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Sistema Refatorado pronto | Data: {'data': {'modules': 'Core + Services'}}
2025-08-25 21:56:57.123 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ FollowUp Service pronto
2025-08-25 21:56:57.123 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üîê GoogleOAuthHandler inicializado
2025-08-25 21:56:57.134 | INFO     | app.services.knowledge_service:__init__:24 | ‚úÖ KnowledgeService inicializado (vers√£o simplificada)
2025-08-25 21:56:57.135 | INFO     | app.utils.logger:log_with_emoji:75 | üöÄ Iniciando AgenticSDR Stateless
2025-08-25 21:56:57.135 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo prim√°rio Gemini configurado pronto | Data: {'model': 'gemini-2.5-pro'}
2025-08-25 21:56:57.144 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo fallback OpenAI configurado pronto | Data: {'model': 'o3-mini'}
2025-08-25 21:56:57.144 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo reasoning configurado pronto | Data: {'model': 'gemini-2.0-flash-thinking'}
2025-08-25 21:56:57.145 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Sistema de modelos configurado pronto | Data: {'primary_model': 'gemini-2.5-pro', 'fallback_available': True, 'reasoning_enabled': True}
2025-08-25 21:56:57.145 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üé® MultimodalProcessor habilitado pronto | Data: {'dependencies': {'ocr': True, 'audio': True, 'pdf': True}}
2025-08-25 21:56:57.145 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üìä LeadManager inicializado pronto
2025-08-25 21:56:57.145 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üß† ContextAnalyzer inicializado pronto
2025-08-25 21:56:57.145 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üìä ConversationMonitor inicializado pronto
2025-08-25 21:56:57.146 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è ‚úÖ ConversationMonitor: Loop iniciado
2025-08-25 21:56:57.337 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üîÑ Access token renovado com sucesso
2025-08-25 21:56:57.343 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: ‚úÖ Servi√ßo Google Calendar constru√≠do com OAuth
2025-08-25 21:56:57.997 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: Google Calendar conectado via OAuth ao calend√°rio: 'leonardofvieira00@gmail.com' | Data: {'calendar_id': 'leonardofvieira00@gmail.com'}
2025-08-25 21:56:59.154 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Kommo CRM conectado: leonardofvieira00
2025-08-25 21:56:59.736 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 9 campos customizados mapeados
2025-08-25 21:57:00.241 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 30 varia√ß√µes de est√°gios mapeadas
2025-08-25 21:57:00.269 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Evolution API conectada: 1 inst√¢ncias
2025-08-25 21:57:00.270 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ AgenticSDR Stateless inicializado! pronto | Data: {'modules': ['ModelManager', 'MultimodalProcessor', 'LeadManager', 'ContextAnalyzer', 'CalendarService', 'CRMService', 'FollowUpService']}
2025-08-25 21:57:00.270 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ AgenticSDR (Stateless) pronto | Data: {'data': {'status': 'sistema pronto'}}
2025-08-25 21:57:00.270 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ FollowUp Services pronto
2025-08-25 21:57:00.270 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è üî• Pr√©-aquecendo AgenticSDR (Stateless)...
2025-08-25 21:57:00.280 | INFO     | app.services.knowledge_service:__init__:24 | ‚úÖ KnowledgeService inicializado (vers√£o simplificada)
2025-08-25 21:57:00.281 | INFO     | app.utils.logger:log_with_emoji:75 | üöÄ Iniciando AgenticSDR Stateless
2025-08-25 21:57:00.281 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo prim√°rio Gemini configurado pronto | Data: {'model': 'gemini-2.5-pro'}
2025-08-25 21:57:00.289 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo fallback OpenAI configurado pronto | Data: {'model': 'o3-mini'}
2025-08-25 21:57:00.290 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo reasoning configurado pronto | Data: {'model': 'gemini-2.0-flash-thinking'}
2025-08-25 21:57:00.290 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Sistema de modelos configurado pronto | Data: {'primary_model': 'gemini-2.5-pro', 'fallback_available': True, 'reasoning_enabled': True}
2025-08-25 21:57:00.290 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üé® MultimodalProcessor habilitado pronto | Data: {'dependencies': {'ocr': True, 'audio': True, 'pdf': True}}
2025-08-25 21:57:00.290 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üìä LeadManager inicializado pronto
2025-08-25 21:57:00.290 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üß† ContextAnalyzer inicializado pronto
2025-08-25 21:57:00.290 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üìä ConversationMonitor inicializado pronto
2025-08-25 21:57:00.291 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è ‚úÖ ConversationMonitor: Loop iniciado
2025-08-25 21:57:00.293 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: ‚úÖ Servi√ßo Google Calendar constru√≠do com OAuth
2025-08-25 21:57:00.893 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: Google Calendar conectado via OAuth ao calend√°rio: 'leonardofvieira00@gmail.com' | Data: {'calendar_id': 'leonardofvieira00@gmail.com'}
2025-08-25 21:57:01.656 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Kommo CRM conectado: leonardofvieira00
2025-08-25 21:57:02.225 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 9 campos customizados mapeados
‚ö†Ô∏è Rate Limiter: Usando burst para kommo
2025-08-25 21:57:02.941 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 30 varia√ß√µes de est√°gios mapeadas
2025-08-25 21:57:02.970 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Evolution API conectada: 1 inst√¢ncias
2025-08-25 21:57:02.970 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ AgenticSDR Stateless inicializado! pronto | Data: {'modules': ['ModelManager', 'MultimodalProcessor', 'LeadManager', 'ContextAnalyzer', 'CalendarService', 'CRMService', 'FollowUpService']}
2025-08-25 21:57:02.971 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ SDR IA Solar Prime pronto | Data: {'startup_ms': 6370.51}
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     127.0.0.1:35830 - "GET /health HTTP/1.1" 200 OK
2025-08-25 21:57:09.613 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/presence-update de evolution-api | Data: {'event': 'PRESENCE_UPDATE', 'endpoint': '/whatsapp/presence-update', 'source': 'evolution-api'}
INFO:     10.11.0.4:52100 - "POST /webhook/evolution/presence-update HTTP/1.1" 200 OK
2025-08-25 21:57:14.447 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/presence-update de evolution-api | Data: {'event': 'PRESENCE_UPDATE', 'endpoint': '/whatsapp/presence-update', 'source': 'evolution-api'}
INFO:     10.11.0.4:52100 - "POST /webhook/evolution/presence-update HTTP/1.1" 200 OK
2025-08-25 21:57:14.502 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/chats-update de evolution-api | Data: {'event': 'CHATS_UPDATE', 'endpoint': '/whatsapp/chats-update', 'source': 'evolution-api'}
2025-08-25 21:57:14.503 | INFO     | app.api.webhooks:whatsapp_dynamic_webhook:761 | CHATS_UPDATE update recebido: {'event': 'chats.update', 'instance': 'SDR IA SolarPrime', 'data': [{'remoteJid': '558182986181@s.whatsapp.net', 'instanceId': '02f1c146-f8b8-4f19-9e8a-d3517ee84269'}, {'remoteJid': '558195554978@s.whatsapp.net', 'instanceId': '02f1c146-f8b8-4f19-9e8a-d3517ee84269'}], 'destination': 'https://sdr-api-evolution-api.fzvgou.easypanel.host/webhook/evolution', 'date_time': '2025-08-25T18:57:14.477Z', 'sender': '558195554978@s.whatsapp.net', 'server_url': 'https://evoapi-evolution-api.fzvgou.easypanel.host', 'apikey': '3ECB607589F3-4D35-949F-BA5D2D5892E9'}
INFO:     10.11.0.4:52100 - "POST /webhook/evolution/chats-update HTTP/1.1" 200 OK
2025-08-25 21:57:14.511 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/presence-update de evolution-api | Data: {'event': 'PRESENCE_UPDATE', 'endpoint': '/whatsapp/presence-update', 'source': 'evolution-api'}
INFO:     10.11.0.4:52100 - "POST /webhook/evolution/presence-update HTTP/1.1" 200 OK
2025-08-25 21:57:14.535 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/messages-upsert de evolution-api | Data: {'event': 'MESSAGES_UPSERT', 'endpoint': '/whatsapp/messages-upsert', 'source': 'evolution-api'}
INFO:     10.11.0.4:52100 - "POST /webhook/evolution/messages-upsert HTTP/1.1" 200 OK
2025-08-25 21:57:14.536 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è Iniciando processamento de 1 nova(s) mensagem(ns)
2025-08-25 21:57:14.536 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è Processando mensagem de 558182986181
2025-08-25 21:57:14.536 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Processando m√≠dia. Message key: {'remoteJid': '558182986181@s.whatsapp.net', 'fromMe': False, 'id': '3A80DE420541622A5748', 'senderLid': '129472024072320@lid'}
2025-08-25 21:57:14.536 | WARNING  | app.utils.logger:log_with_emoji:75 | ‚ö†Ô∏è Nenhum tipo de m√≠dia reconhecido encontrado no payload
2025-08-25 21:57:14.536 | INFO     | app.utils.logger:log_with_emoji:75 | üì• Recebido text de 558182986181 | Data: {'preview': 'eu', 'sender': '558182986181', 'type': 'text'}
2025-08-25 21:57:14.738 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/contacts-update de evolution-api | Data: {'event': 'CONTACTS_UPDATE', 'endpoint': '/whatsapp/contacts-update', 'source': 'evolution-api'}
2025-08-25 21:57:14.739 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è === IN√çCIO AN√ÅLISE CONTACTS_UPDATE ===
2025-08-25 21:57:14.739 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Payload RAW completo:
{
  "event": "contacts.update",
  "instance": "SDR IA SolarPrime",
  "data": [
    {
      "remoteJid": "558182986181@s.whatsapp.net",
      "pushName": "Mateus M",
      "profilePicUrl": "https://pps.whatsapp.net/v/t61.24694-24/521428372_23966156116410343_3058739794538851299_n.jpg?ccb=11-4&oh=01_Q5Aa2QHA0accMmwVQ0kGQqxZWoRDME2SU5PBaDhuJ4XQqsHBkw&oe=68BA0A4D&_nc_sid=5e03e0&_nc_cat=104",
      "instanceId": "02f1c146-f8b8-4f19-9e8a-d3517ee84269"
    }
  ],
  "destination": "https://sdr-api-evolution-api.fzvgou.easypanel.host/webhook/evolution",
  "date_time": "2025-08-25T18:57:14.730Z",
  "sender": "558195554978@s.whatsapp.net",
  "server_url": "https://evoapi-evolution-api.fzvgou.easypanel.host",
  "apikey": "3ECB607589F3-4D35-949F-BA5D2D5892E9"
}
2025-08-25 21:57:14.739 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Tipo do payload: <class 'dict'>
2025-08-25 21:57:14.739 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Chaves do payload: ['event', 'instance', 'data', 'destination', 'date_time', 'sender', 'server_url', 'apikey']
2025-08-25 21:57:14.739 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è contact_data inicial: [
  {
    "remoteJid": "558182986181@s.whatsapp.net",
    "pushName": "Mateus M",
    "profilePicUrl": "https://pps.whatsapp.net/v/t61.24694-24/521428372_23966156116410343_3058739794538851299_n.jpg?ccb=11-4&oh=01_Q5Aa2QHA0accMmwVQ0kGQqxZWoRDME2SU5PBaDhuJ4XQqsHBkw&oe=68BA0A4D&_nc_sid=5e03e0&_nc_cat=104",
    "instanceId": "02f1c146-f8b8-4f19-9e8a-d3517ee84269"
  }
]
2025-08-25 21:57:14.739 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è contact_data √© lista com 1 itens
2025-08-25 21:57:14.740 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Usando primeiro item da lista: {
  "remoteJid": "558182986181@s.whatsapp.net",
  "pushName": "Mateus M",
  "profilePicUrl": "https://pps.whatsapp.net/v/t61.24694-24/521428372_23966156116410343_3058739794538851299_n.jpg?ccb=11-4&oh=01_Q5Aa2QHA0accMmwVQ0kGQqxZWoRDME2SU5PBaDhuJ4XQqsHBkw&oe=68BA0A4D&_nc_sid=5e03e0&_nc_cat=104",
  "instanceId": "02f1c146-f8b8-4f19-9e8a-d3517ee84269"
}
2025-08-25 21:57:14.740 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è contact_data final para processamento: {
  "remoteJid": "558182986181@s.whatsapp.net",
  "pushName": "Mateus M",
  "profilePicUrl": "https://pps.whatsapp.net/v/t61.24694-24/521428372_23966156116410343_3058739794538851299_n.jpg?ccb=11-4&oh=01_Q5Aa2QHA0accMmwVQ0kGQqxZWoRDME2SU5PBaDhuJ4XQqsHBkw&oe=68BA0A4D&_nc_sid=5e03e0&_nc_cat=104",
  "instanceId": "02f1c146-f8b8-4f19-9e8a-d3517ee84269"
}
2025-08-25 21:57:14.740 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Chaves dispon√≠veis em contact_data: ['remoteJid', 'pushName', 'profilePicUrl', 'instanceId']
2025-08-25 21:57:14.740 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è === IN√çCIO EXTRA√á√ÉO DE TELEFONE ===
2025-08-25 21:57:14.740 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Tentativa 0 - campo 'remoteJid' RAW: '558182986181@s.whatsapp.net'
2025-08-25 21:57:14.741 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Tentativa 0 - telefone extra√≠do de remoteJid: '558182986181'
2025-08-25 21:57:14.741 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è === RESULTADO FINAL DA EXTRA√á√ÉO ===
2025-08-25 21:57:14.741 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Telefone extra√≠do: '558182986181' (v√°lido: True)
2025-08-25 21:57:14.742 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è PushName extra√≠do: 'Mateus M' (v√°lido: True)
2025-08-25 21:57:14.742 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è === FIM AN√ÅLISE CONTACTS_UPDATE ===
2025-08-25 21:57:14.998 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Lead 558182986181 j√° possui nome 'Mateus M', n√£o sobrescrevendo com 'Mateus M'
INFO:     10.11.0.4:52100 - "POST /webhook/evolution/contacts-update HTTP/1.1" 200 OK
2025-08-25 21:57:15.000 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/contacts-update de evolution-api | Data: {'event': 'CONTACTS_UPDATE', 'endpoint': '/whatsapp/contacts-update', 'source': 'evolution-api'}
2025-08-25 21:57:15.000 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è üö´ CONTACTS_UPDATE ignorado - Duplicata detectada para 558182986181@s.whatsapp.net (processado h√° 0.3s)
INFO:     10.11.0.4:35588 - "POST /webhook/evolution/contacts-update HTTP/1.1" 200 OK
2025-08-25 21:57:15.044 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/chats-update de evolution-api | Data: {'event': 'CHATS_UPDATE', 'endpoint': '/whatsapp/chats-update', 'source': 'evolution-api'}
2025-08-25 21:57:15.044 | INFO     | app.api.webhooks:whatsapp_dynamic_webhook:761 | CHATS_UPDATE update recebido: {'event': 'chats.update', 'instance': 'SDR IA SolarPrime', 'data': [{'remoteJid': '558182986181@s.whatsapp.net', 'instanceId': '02f1c146-f8b8-4f19-9e8a-d3517ee84269'}], 'destination': 'https://sdr-api-evolution-api.fzvgou.easypanel.host/webhook/evolution', 'date_time': '2025-08-25T18:57:15.034Z', 'sender': '558195554978@s.whatsapp.net', 'server_url': 'https://evoapi-evolution-api.fzvgou.easypanel.host', 'apikey': '3ECB607589F3-4D35-949F-BA5D2D5892E9'}
INFO:     10.11.0.4:35588 - "POST /webhook/evolution/chats-update HTTP/1.1" 200 OK
2025-08-25 21:57:15.056 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/messages-upsert de evolution-api | Data: {'event': 'MESSAGES_UPSERT', 'endpoint': '/whatsapp/messages-upsert', 'source': 'evolution-api'}
INFO:     10.11.0.4:35588 - "POST /webhook/evolution/messages-upsert HTTP/1.1" 200 OK
2025-08-25 21:57:15.057 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è Iniciando processamento de 1 nova(s) mensagem(ns)
2025-08-25 21:57:15.058 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è Processando mensagem de 558182986181
2025-08-25 21:57:15.059 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Processando m√≠dia. Message key: {'remoteJid': '558182986181@s.whatsapp.net', 'fromMe': False, 'id': '3A0A8DFF12B650FD8EF5', 'senderLid': '129472024072320@lid'}
2025-08-25 21:57:15.059 | WARNING  | app.utils.logger:log_with_emoji:75 | ‚ö†Ô∏è Nenhum tipo de m√≠dia reconhecido encontrado no payload
2025-08-25 21:57:15.060 | INFO     | app.utils.logger:log_with_emoji:75 | üì• Recebido text de 558182986181 | Data: {'preview': 'quero', 'sender': '558182986181', 'type': 'text'}
2025-08-25 21:57:15.063 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/presence-update de evolution-api | Data: {'event': 'PRESENCE_UPDATE', 'endpoint': '/whatsapp/presence-update', 'source': 'evolution-api'}
INFO:     10.11.0.4:35588 - "POST /webhook/evolution/presence-update HTTP/1.1" 200 OK
2025-08-25 21:57:15.072 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/chats-update de evolution-api | Data: {'event': 'CHATS_UPDATE', 'endpoint': '/whatsapp/chats-update', 'source': 'evolution-api'}
2025-08-25 21:57:15.073 | INFO     | app.api.webhooks:whatsapp_dynamic_webhook:761 | CHATS_UPDATE update recebido: {'event': 'chats.update', 'instance': 'SDR IA SolarPrime', 'data': [{'remoteJid': '558195554978@s.whatsapp.net', 'instanceId': '02f1c146-f8b8-4f19-9e8a-d3517ee84269'}], 'destination': 'https://sdr-api-evolution-api.fzvgou.easypanel.host/webhook/evolution', 'date_time': '2025-08-25T18:57:15.056Z', 'sender': '558195554978@s.whatsapp.net', 'server_url': 'https://evoapi-evolution-api.fzvgou.easypanel.host', 'apikey': '3ECB607589F3-4D35-949F-BA5D2D5892E9'}
INFO:     10.11.0.4:35588 - "POST /webhook/evolution/chats-update HTTP/1.1" 200 OK
2025-08-25 21:57:15.304 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/contacts-update de evolution-api | Data: {'event': 'CONTACTS_UPDATE', 'endpoint': '/whatsapp/contacts-update', 'source': 'evolution-api'}
2025-08-25 21:57:15.305 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è üö´ CONTACTS_UPDATE ignorado - Duplicata detectada para 558182986181@s.whatsapp.net (processado h√° 0.6s)
INFO:     10.11.0.4:35588 - "POST /webhook/evolution/contacts-update HTTP/1.1" 200 OK
2025-08-25 21:57:15.346 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/contacts-update de evolution-api | Data: {'event': 'CONTACTS_UPDATE', 'endpoint': '/whatsapp/contacts-update', 'source': 'evolution-api'}
2025-08-25 21:57:15.346 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è üö´ CONTACTS_UPDATE ignorado - Duplicata detectada para 558182986181@s.whatsapp.net (processado h√° 0.6s)
INFO:     10.11.0.4:35588 - "POST /webhook/evolution/contacts-update HTTP/1.1" 200 OK
2025-08-25 21:57:15.399 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/presence-update de evolution-api | Data: {'event': 'PRESENCE_UPDATE', 'endpoint': '/whatsapp/presence-update', 'source': 'evolution-api'}
INFO:     10.11.0.4:35588 - "POST /webhook/evolution/presence-update HTTP/1.1" 200 OK
2025-08-25 21:57:16.062 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è üîÑ Processando 2 mensagens combinadas para 558182986181 (total: 8 chars)
2025-08-25 21:57:16.062 | INFO     | app.utils.logger:log_with_emoji:75 | üí¨ üöÄ INICIANDO PROCESSAMENTO PRINCIPAL - Telefone: 558182986181, Mensagem: 'eu
quero...', ID: 3A0A8DFF12B650FD8EF5
2025-08-25 21:57:17.506 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Lead encontrado - ID: 9c2bb788-7efc-408c-859f-07669786b765, Nome: 'Mateus M'
2025-08-25 21:57:17.507 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Conversa encontrada - ID: 25d7c06b-a1b0-4e38-b38c-0ed491591677
2025-08-25 21:57:17.507 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Conversa validada - ID: 25d7c06b-a1b0-4e38-b38c-0ed491591677, Phone: 558182986181
2025-08-25 21:57:18.945 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/chats-update de evolution-api | Data: {'event': 'CHATS_UPDATE', 'endpoint': '/whatsapp/chats-update', 'source': 'evolution-api'}
2025-08-25 21:57:18.945 | INFO     | app.api.webhooks:whatsapp_dynamic_webhook:761 | CHATS_UPDATE update recebido: {'event': 'chats.update', 'instance': 'SDR IA SolarPrime', 'data': [{'remoteJid': '558182986181@s.whatsapp.net', 'instanceId': '02f1c146-f8b8-4f19-9e8a-d3517ee84269'}], 'destination': 'https://sdr-api-evolution-api.fzvgou.easypanel.host/webhook/evolution', 'date_time': '2025-08-25T18:57:17.582Z', 'sender': '558195554978@s.whatsapp.net', 'server_url': 'https://evoapi-evolution-api.fzvgou.easypanel.host', 'apikey': '3ECB607589F3-4D35-949F-BA5D2D5892E9'}
INFO:     10.11.0.4:35588 - "POST /webhook/evolution/chats-update HTTP/1.1" 200 OK
2025-08-25 21:57:18.946 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/messages-upsert de evolution-api | Data: {'event': 'MESSAGES_UPSERT', 'endpoint': '/whatsapp/messages-upsert', 'source': 'evolution-api'}
INFO:     10.11.0.4:52100 - "POST /webhook/evolution/messages-upsert HTTP/1.1" 200 OK
2025-08-25 21:57:18.946 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è Iniciando processamento de 1 nova(s) mensagem(ns)
2025-08-25 21:57:18.947 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è Processando mensagem de 558182986181
2025-08-25 21:57:18.947 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Processando m√≠dia. Message key: {'remoteJid': '558182986181@s.whatsapp.net', 'fromMe': False, 'id': '3A7AFF9AFA065D6DBAAF', 'senderLid': '129472024072320@lid'}
2025-08-25 21:57:18.947 | WARNING  | app.utils.logger:log_with_emoji:75 | ‚ö†Ô∏è Nenhum tipo de m√≠dia reconhecido encontrado no payload
2025-08-25 21:57:18.947 | INFO     | app.utils.logger:log_with_emoji:75 | üì• Recebido text de 558182986181 | Data: {'preview': 'reagendar', 'sender': '558182986181', 'type': 'text'}
2025-08-25 21:57:18.948 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/contacts-update de evolution-api | Data: {'event': 'CONTACTS_UPDATE', 'endpoint': '/whatsapp/contacts-update', 'source': 'evolution-api'}
2025-08-25 21:57:18.948 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è üö´ CONTACTS_UPDATE ignorado - Duplicata detectada para 558182986181@s.whatsapp.net (processado h√° 4.2s)
INFO:     10.11.0.4:35600 - "POST /webhook/evolution/contacts-update HTTP/1.1" 200 OK
2025-08-25 21:57:18.949 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/contacts-update de evolution-api | Data: {'event': 'CONTACTS_UPDATE', 'endpoint': '/whatsapp/contacts-update', 'source': 'evolution-api'}
2025-08-25 21:57:18.950 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è üö´ CONTACTS_UPDATE ignorado - Duplicata detectada para 558182986181@s.whatsapp.net (processado h√° 4.2s)
INFO:     10.11.0.4:35602 - "POST /webhook/evolution/contacts-update HTTP/1.1" 200 OK
2025-08-25 21:57:18.951 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/presence-update de evolution-api | Data: {'event': 'PRESENCE_UPDATE', 'endpoint': '/whatsapp/presence-update', 'source': 'evolution-api'}
INFO:     10.11.0.4:35612 - "POST /webhook/evolution/presence-update HTTP/1.1" 200 OK
2025-08-25 21:57:18.951 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Mensagem e cache salvos
2025-08-25 21:57:18.952 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è Criando AGENTIC SDR Stateless...
2025-08-25 21:57:18.952 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è üè≠ Criando agente stateless com contexto...
2025-08-25 21:57:20.107 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Kommo CRM conectado: leonardofvieira00
2025-08-25 21:57:20.616 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/chats-update de evolution-api | Data: {'event': 'CHATS_UPDATE', 'endpoint': '/whatsapp/chats-update', 'source': 'evolution-api'}
2025-08-25 21:57:20.616 | INFO     | app.api.webhooks:whatsapp_dynamic_webhook:761 | CHATS_UPDATE update recebido: {'event': 'chats.update', 'instance': 'SDR IA SolarPrime', 'data': [{'remoteJid': '558182986181@s.whatsapp.net', 'instanceId': '02f1c146-f8b8-4f19-9e8a-d3517ee84269'}], 'destination': 'https://sdr-api-evolution-api.fzvgou.easypanel.host/webhook/evolution', 'date_time': '2025-08-25T18:57:20.609Z', 'sender': '558195554978@s.whatsapp.net', 'server_url': 'https://evoapi-evolution-api.fzvgou.easypanel.host', 'apikey': '3ECB607589F3-4D35-949F-BA5D2D5892E9'}
INFO:     10.11.0.4:35612 - "POST /webhook/evolution/chats-update HTTP/1.1" 200 OK
2025-08-25 21:57:20.653 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/messages-upsert de evolution-api | Data: {'event': 'MESSAGES_UPSERT', 'endpoint': '/whatsapp/messages-upsert', 'source': 'evolution-api'}
INFO:     10.11.0.4:35612 - "POST /webhook/evolution/messages-upsert HTTP/1.1" 200 OK
2025-08-25 21:57:20.654 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è Iniciando processamento de 1 nova(s) mensagem(ns)
2025-08-25 21:57:20.654 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è Processando mensagem de 558182986181
2025-08-25 21:57:20.654 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Processando m√≠dia. Message key: {'remoteJid': '558182986181@s.whatsapp.net', 'fromMe': False, 'id': '3A3EAB812127AF2B9C35', 'senderLid': '129472024072320@lid'}
2025-08-25 21:57:20.655 | WARNING  | app.utils.logger:log_with_emoji:75 | ‚ö†Ô∏è Nenhum tipo de m√≠dia reconhecido encontrado no payload
2025-08-25 21:57:20.655 | INFO     | app.utils.logger:log_with_emoji:75 | üì• Recebido text de 558182986181 | Data: {'preview': 'j√° disse antes po', 'sender': '558182986181', 'type': 'text'}
2025-08-25 21:57:20.676 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 9 campos customizados mapeados
2025-08-25 21:57:20.877 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/contacts-update de evolution-api | Data: {'event': 'CONTACTS_UPDATE', 'endpoint': '/whatsapp/contacts-update', 'source': 'evolution-api'}
2025-08-25 21:57:20.877 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è üö´ CONTACTS_UPDATE ignorado - Duplicata detectada para 558182986181@s.whatsapp.net (processado h√° 6.1s)
INFO:     10.11.0.4:35612 - "POST /webhook/evolution/contacts-update HTTP/1.1" 200 OK
2025-08-25 21:57:20.938 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/contacts-update de evolution-api | Data: {'event': 'CONTACTS_UPDATE', 'endpoint': '/whatsapp/contacts-update', 'source': 'evolution-api'}
2025-08-25 21:57:20.938 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è üö´ CONTACTS_UPDATE ignorado - Duplicata detectada para 558182986181@s.whatsapp.net (processado h√° 6.2s)
INFO:     10.11.0.4:35612 - "POST /webhook/evolution/contacts-update HTTP/1.1" 200 OK
2025-08-25 21:57:21.249 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 30 varia√ß√µes de est√°gios mapeadas
2025-08-25 21:57:23.042 | INFO     | app.services.knowledge_service:__init__:24 | ‚úÖ KnowledgeService inicializado (vers√£o simplificada)
2025-08-25 21:57:23.043 | INFO     | app.utils.logger:log_with_emoji:75 | üöÄ Iniciando AgenticSDR Stateless
2025-08-25 21:57:23.043 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo prim√°rio Gemini configurado pronto | Data: {'model': 'gemini-2.5-pro'}
2025-08-25 21:57:23.053 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo fallback OpenAI configurado pronto | Data: {'model': 'o3-mini'}
2025-08-25 21:57:23.053 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo reasoning configurado pronto | Data: {'model': 'gemini-2.0-flash-thinking'}
2025-08-25 21:57:23.053 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Sistema de modelos configurado pronto | Data: {'primary_model': 'gemini-2.5-pro', 'fallback_available': True, 'reasoning_enabled': True}
2025-08-25 21:57:23.054 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üé® MultimodalProcessor habilitado pronto | Data: {'dependencies': {'ocr': True, 'audio': True, 'pdf': True}}
2025-08-25 21:57:23.054 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üìä LeadManager inicializado pronto
2025-08-25 21:57:23.054 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üß† ContextAnalyzer inicializado pronto
2025-08-25 21:57:23.054 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üìä ConversationMonitor inicializado pronto
2025-08-25 21:57:23.054 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è ‚úÖ ConversationMonitor: Loop iniciado
2025-08-25 21:57:23.057 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: ‚úÖ Servi√ßo Google Calendar constru√≠do com OAuth
2025-08-25 21:57:23.341 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: Google Calendar conectado via OAuth ao calend√°rio: 'leonardofvieira00@gmail.com' | Data: {'calendar_id': 'leonardofvieira00@gmail.com'}
2025-08-25 21:57:24.163 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Kommo CRM conectado: leonardofvieira00
‚ö†Ô∏è Rate Limiter: Usando burst para kommo
2025-08-25 21:57:24.703 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 9 campos customizados mapeados
‚ö†Ô∏è Rate Limiter: Usando burst para kommo
2025-08-25 21:57:25.210 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 30 varia√ß√µes de est√°gios mapeadas
2025-08-25 21:57:25.241 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Evolution API conectada: 1 inst√¢ncias
2025-08-25 21:57:25.241 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ AgenticSDR Stateless inicializado! pronto | Data: {'modules': ['ModelManager', 'MultimodalProcessor', 'LeadManager', 'ContextAnalyzer', 'CalendarService', 'CRMService', 'FollowUpService']}
2025-08-25 21:57:25.242 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ Agente stateless criado com contexto pronto | Data: {'history_count': 53, 'lead_name': 'Mateus M'}
2025-08-25 21:57:25.242 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è AGENTIC SDR Stateless pronto para uso
2025-08-25 21:57:25.242 | INFO     | app.utils.logger:log_with_emoji:75 | ü§ñ AGENTIC SDR: ü§ñ AGENTE STATELESS INICIADO - Mensagem: 'eu
quero...'
2025-08-25 21:57:25.243 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Mensagem do usu√°rio registrada
2025-08-25 21:57:25.244 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Mensagem adicionada ao hist√≥rico. Total: 54 mensagens
2025-08-25 21:57:25.245 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Contexto analisado - Sentimento: {'enabled': True, 'sentiment': 'positivo', 'score': 0.2, 'confidence': 0.7}, Urg√™ncia: normal
2025-08-25 21:57:25.245 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Lead atualizado - Nome: 'Mateus M', Valor: 359.1
2025-08-25 21:57:25.246 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ CONTEXTO ATUALIZADO - Hist√≥rico e lead_info finalizados
2025-08-25 21:57:25.246 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Contexto atualizado - Lead: Mateus M, Hist√≥rico: 54 msgs
2025-08-25 21:57:25.246 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Sincroniza√ß√£o externa conclu√≠da
2025-08-25 21:57:25.246 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è CRM Sync: Payload de atualiza√ß√£o gerado. | Data: {'payload': {'chosen_flow': 'Compra com Desconto', 'name': 'Mateus M', 'bill_value': 359.1, 'phone': '558182986181', 'qualification_score': 35, 'tags': ['Compra com Desconto']}}
üö´ Rate Limiter: Bloqueando kommo. Aguarde 4.3s
‚è≥ Rate Limiter: Aguardando 5.3s para kommo...
‚ö†Ô∏è Rate Limiter: Usando burst para kommo
2025-08-25 21:57:30.845 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/presence-update de evolution-api | Data: {'event': 'PRESENCE_UPDATE', 'endpoint': '/whatsapp/presence-update', 'source': 'evolution-api'}
INFO:     10.11.0.4:48080 - "POST /webhook/evolution/presence-update HTTP/1.1" 200 OK
2025-08-25 21:57:31.139 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è CRM Sync: Dados do lead atualizados no Kommo. | Data: {'payload': {'chosen_flow': 'Compra com Desconto', 'name': 'Mateus M', 'bill_value': 359.1, 'phone': '558182986181', 'qualification_score': 35, 'tags': ['Compra com Desconto']}}
2025-08-25 21:57:31.139 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Dados CRM sincronizados
INFO:     10.11.0.4:48080 - "POST /webhook/kommo/events HTTP/1.1" 200 OK
INFO:     127.0.0.1:59018 - "GET /health HTTP/1.1" 200 OK
2025-08-25 21:57:45.722 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Resposta LLM gerada: '<RESPOSTA_FINAL>Recebido e anotado, Mateus! Essa sua determina√ß√£o √© o que faz o projeto dar certo. P...'
2025-08-25 21:57:45.723 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Resposta do assistente registrada
2025-08-25 21:57:45.723 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ AGENTIC SUCCESS: ‚úÖ AGENTE STATELESS CONCLU√çDO - 558182986181: 'eu
quero...' -> '<RESPOSTA_FINAL>Recebido e anotado, Mateus! Essa s...'
2025-08-25 21:57:45.724 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Resposta gerada pelo agente: '<RESPOSTA_FINAL>Recebido e anotado, Mateus! Essa sua determina√ß√£o √© o que faz o projeto dar certo. P...'
2025-08-25 21:57:46.798 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Resposta do assistente salva
2025-08-25 21:57:47.037 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Lead atualizado
2025-08-25 21:57:54.004 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Evolution API - Typing enviado para 558182986181 (dura√ß√£o: 4.73s, tamanho: 176)
2025-08-25 21:58:01.041 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Evolution API - Mensagem de texto enviada para 558182986181 (tamanho: 176, delay: 1.81s)
2025-08-25 21:58:01.041 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Resposta enviada via WhatsApp
2025-08-25 21:58:01.041 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ PROCESSAMENTO PRINCIPAL CONCLU√çDO - 558182986181: 'eu
quero...' -> 'Recebido e anotado, Mateus! Essa sua determina√ß√£o ...'
2025-08-25 21:58:02.191 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/messages-update de evolution-api | Data: {'event': 'MESSAGES_UPDATE', 'endpoint': '/whatsapp/messages-update', 'source': 'evolution-api'}
INFO:     10.11.0.4:57270 - "POST /webhook/evolution/messages-update HTTP/1.1" 200 OK
INFO:     127.0.0.1:48950 - "GET /health HTTP/1.1" 200 OK
2025-08-25 21:58:11.688 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/presence-update de evolution-api | Data: {'event': 'PRESENCE_UPDATE', 'endpoint': '/whatsapp/presence-update', 'source': 'evolution-api'}
INFO:     10.11.0.4:46624 - "POST /webhook/evolution/presence-update HTTP/1.1" 200 OK
2025-08-25 21:58:14.004 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/chats-update de evolution-api | Data: {'event': 'CHATS_UPDATE', 'endpoint': '/whatsapp/chats-update', 'source': 'evolution-api'}
2025-08-25 21:58:14.005 | INFO     | app.api.webhooks:whatsapp_dynamic_webhook:761 | CHATS_UPDATE update recebido: {'event': 'chats.update', 'instance': 'SDR IA SolarPrime', 'data': [{'remoteJid': '558182986181@s.whatsapp.net', 'instanceId': '02f1c146-f8b8-4f19-9e8a-d3517ee84269'}], 'destination': 'https://sdr-api-evolution-api.fzvgou.easypanel.host/webhook/evolution', 'date_time': '2025-08-25T18:58:13.998Z', 'sender': '558195554978@s.whatsapp.net', 'server_url': 'https://evoapi-evolution-api.fzvgou.easypanel.host', 'apikey': '3ECB607589F3-4D35-949F-BA5D2D5892E9'}
INFO:     10.11.0.4:46624 - "POST /webhook/evolution/chats-update HTTP/1.1" 200 OK
2025-08-25 21:58:14.024 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/messages-upsert de evolution-api | Data: {'event': 'MESSAGES_UPSERT', 'endpoint': '/whatsapp/messages-upsert', 'source': 'evolution-api'}
INFO:     10.11.0.4:46624 - "POST /webhook/evolution/messages-upsert HTTP/1.1" 200 OK
2025-08-25 21:58:14.026 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è Iniciando processamento de 1 nova(s) mensagem(ns)
2025-08-25 21:58:14.026 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è Processando mensagem de 558182986181
2025-08-25 21:58:14.026 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Processando m√≠dia. Message key: {'remoteJid': '558182986181@s.whatsapp.net', 'fromMe': False, 'id': '3ACA4F7A5DA120CBD757', 'senderLid': '129472024072320@lid'}
2025-08-25 21:58:14.026 | WARNING  | app.utils.logger:log_with_emoji:75 | ‚ö†Ô∏è Nenhum tipo de m√≠dia reconhecido encontrado no payload
2025-08-25 21:58:14.027 | INFO     | app.utils.logger:log_with_emoji:75 | üì• Recebido text de 558182986181 | Data: {'preview': 'reagende a reuniao', 'sender': '558182986181', 'type': 'text'}
2025-08-25 21:58:14.266 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/contacts-update de evolution-api | Data: {'event': 'CONTACTS_UPDATE', 'endpoint': '/whatsapp/contacts-update', 'source': 'evolution-api'}
2025-08-25 21:58:14.267 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è === IN√çCIO AN√ÅLISE CONTACTS_UPDATE ===
2025-08-25 21:58:14.267 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Payload RAW completo:
{
  "event": "contacts.update",
  "instance": "SDR IA SolarPrime",
  "data": [
    {
      "remoteJid": "558182986181@s.whatsapp.net",
      "pushName": "Mateus M",
      "profilePicUrl": "https://pps.whatsapp.net/v/t61.24694-24/521428372_23966156116410343_3058739794538851299_n.jpg?ccb=11-4&oh=01_Q5Aa2QHA0accMmwVQ0kGQqxZWoRDME2SU5PBaDhuJ4XQqsHBkw&oe=68BA0A4D&_nc_sid=5e03e0&_nc_cat=104",
      "instanceId": "02f1c146-f8b8-4f19-9e8a-d3517ee84269"
    }
  ],
  "destination": "https://sdr-api-evolution-api.fzvgou.easypanel.host/webhook/evolution",
  "date_time": "2025-08-25T18:58:14.259Z",
  "sender": "558195554978@s.whatsapp.net",
  "server_url": "https://evoapi-evolution-api.fzvgou.easypanel.host",
  "apikey": "3ECB607589F3-4D35-949F-BA5D2D5892E9"
}
2025-08-25 21:58:14.267 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Tipo do payload: <class 'dict'>
2025-08-25 21:58:14.268 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Chaves do payload: ['event', 'instance', 'data', 'destination', 'date_time', 'sender', 'server_url', 'apikey']
2025-08-25 21:58:14.268 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è contact_data inicial: [
  {
    "remoteJid": "558182986181@s.whatsapp.net",
    "pushName": "Mateus M",
    "profilePicUrl": "https://pps.whatsapp.net/v/t61.24694-24/521428372_23966156116410343_3058739794538851299_n.jpg?ccb=11-4&oh=01_Q5Aa2QHA0accMmwVQ0kGQqxZWoRDME2SU5PBaDhuJ4XQqsHBkw&oe=68BA0A4D&_nc_sid=5e03e0&_nc_cat=104",
    "instanceId": "02f1c146-f8b8-4f19-9e8a-d3517ee84269"
  }
]
2025-08-25 21:58:14.268 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è contact_data √© lista com 1 itens
2025-08-25 21:58:14.268 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Usando primeiro item da lista: {
  "remoteJid": "558182986181@s.whatsapp.net",
  "pushName": "Mateus M",
  "profilePicUrl": "https://pps.whatsapp.net/v/t61.24694-24/521428372_23966156116410343_3058739794538851299_n.jpg?ccb=11-4&oh=01_Q5Aa2QHA0accMmwVQ0kGQqxZWoRDME2SU5PBaDhuJ4XQqsHBkw&oe=68BA0A4D&_nc_sid=5e03e0&_nc_cat=104",
  "instanceId": "02f1c146-f8b8-4f19-9e8a-d3517ee84269"
}
2025-08-25 21:58:14.269 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è contact_data final para processamento: {
  "remoteJid": "558182986181@s.whatsapp.net",
  "pushName": "Mateus M",
  "profilePicUrl": "https://pps.whatsapp.net/v/t61.24694-24/521428372_23966156116410343_3058739794538851299_n.jpg?ccb=11-4&oh=01_Q5Aa2QHA0accMmwVQ0kGQqxZWoRDME2SU5PBaDhuJ4XQqsHBkw&oe=68BA0A4D&_nc_sid=5e03e0&_nc_cat=104",
  "instanceId": "02f1c146-f8b8-4f19-9e8a-d3517ee84269"
}
2025-08-25 21:58:14.269 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Chaves dispon√≠veis em contact_data: ['remoteJid', 'pushName', 'profilePicUrl', 'instanceId']
2025-08-25 21:58:14.269 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è === IN√çCIO EXTRA√á√ÉO DE TELEFONE ===
2025-08-25 21:58:14.269 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Tentativa 0 - campo 'remoteJid' RAW: '558182986181@s.whatsapp.net'
2025-08-25 21:58:14.269 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Tentativa 0 - telefone extra√≠do de remoteJid: '558182986181'
2025-08-25 21:58:14.269 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è === RESULTADO FINAL DA EXTRA√á√ÉO ===
2025-08-25 21:58:14.269 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Telefone extra√≠do: '558182986181' (v√°lido: True)
2025-08-25 21:58:14.269 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è PushName extra√≠do: 'Mateus M' (v√°lido: True)
2025-08-25 21:58:14.270 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è === FIM AN√ÅLISE CONTACTS_UPDATE ===
2025-08-25 21:58:14.543 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Lead 558182986181 j√° possui nome 'Mateus M', n√£o sobrescrevendo com 'Mateus M'
INFO:     10.11.0.4:46624 - "POST /webhook/evolution/contacts-update HTTP/1.1" 200 OK
2025-08-25 21:58:14.544 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/contacts-update de evolution-api | Data: {'event': 'CONTACTS_UPDATE', 'endpoint': '/whatsapp/contacts-update', 'source': 'evolution-api'}
2025-08-25 21:58:14.544 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è üö´ CONTACTS_UPDATE ignorado - Duplicata detectada para 558182986181@s.whatsapp.net (processado h√° 0.3s)
INFO:     10.11.0.4:57468 - "POST /webhook/evolution/contacts-update HTTP/1.1" 200 OK
2025-08-25 21:58:15.030 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è üîÑ Processando 3 mensagens combinadas para 558182986181 (total: 46 chars)
2025-08-25 21:58:15.030 | INFO     | app.utils.logger:log_with_emoji:75 | üí¨ üöÄ INICIANDO PROCESSAMENTO PRINCIPAL - Telefone: 558182986181, Mensagem: 'reagendar
j√° disse antes po
reagende a reuniao...', ID: 3ACA4F7A5DA120CBD757
2025-08-25 21:58:15.718 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/messages-update de evolution-api | Data: {'event': 'MESSAGES_UPDATE', 'endpoint': '/whatsapp/messages-update', 'source': 'evolution-api'}
INFO:     10.11.0.4:57468 - "POST /webhook/evolution/messages-update HTTP/1.1" 200 OK
2025-08-25 21:58:15.719 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/chats-upsert de evolution-api | Data: {'event': 'CHATS_UPSERT', 'endpoint': '/whatsapp/chats-upsert', 'source': 'evolution-api'}
2025-08-25 21:58:15.719 | WARNING  | app.api.webhooks:whatsapp_dynamic_webhook:765 | Evento n√£o reconhecido: CHATS_UPSERT
INFO:     10.11.0.4:46624 - "POST /webhook/evolution/chats-upsert HTTP/1.1" 200 OK
2025-08-25 21:58:15.720 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Lead encontrado - ID: 9c2bb788-7efc-408c-859f-07669786b765, Nome: 'Mateus M'
2025-08-25 21:58:15.720 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Conversa encontrada - ID: 25d7c06b-a1b0-4e38-b38c-0ed491591677
2025-08-25 21:58:15.720 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Conversa validada - ID: 25d7c06b-a1b0-4e38-b38c-0ed491591677, Phone: 558182986181
2025-08-25 21:58:16.428 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Mensagem e cache salvos
2025-08-25 21:58:16.429 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è Criando AGENTIC SDR Stateless...
2025-08-25 21:58:16.429 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è üè≠ Criando agente stateless com contexto...
2025-08-25 21:58:17.192 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Kommo CRM conectado: leonardofvieira00
2025-08-25 21:58:17.764 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 9 campos customizados mapeados
2025-08-25 21:58:18.338 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 30 varia√ß√µes de est√°gios mapeadas
2025-08-25 21:58:19.782 | INFO     | app.services.knowledge_service:__init__:24 | ‚úÖ KnowledgeService inicializado (vers√£o simplificada)
2025-08-25 21:58:19.782 | INFO     | app.utils.logger:log_with_emoji:75 | üöÄ Iniciando AgenticSDR Stateless
2025-08-25 21:58:19.782 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo prim√°rio Gemini configurado pronto | Data: {'model': 'gemini-2.5-pro'}
2025-08-25 21:58:19.789 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo fallback OpenAI configurado pronto | Data: {'model': 'o3-mini'}
2025-08-25 21:58:19.790 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo reasoning configurado pronto | Data: {'model': 'gemini-2.0-flash-thinking'}
2025-08-25 21:58:19.790 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Sistema de modelos configurado pronto | Data: {'primary_model': 'gemini-2.5-pro', 'fallback_available': True, 'reasoning_enabled': True}
2025-08-25 21:58:19.790 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üé® MultimodalProcessor habilitado pronto | Data: {'dependencies': {'ocr': True, 'audio': True, 'pdf': True}}
2025-08-25 21:58:19.792 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üìä LeadManager inicializado pronto
2025-08-25 21:58:19.792 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üß† ContextAnalyzer inicializado pronto
2025-08-25 21:58:19.792 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üìä ConversationMonitor inicializado pronto
2025-08-25 21:58:19.793 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è ‚úÖ ConversationMonitor: Loop iniciado
2025-08-25 21:58:19.795 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: ‚úÖ Servi√ßo Google Calendar constru√≠do com OAuth
2025-08-25 21:58:20.432 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: Google Calendar conectado via OAuth ao calend√°rio: 'leonardofvieira00@gmail.com' | Data: {'calendar_id': 'leonardofvieira00@gmail.com'}
2025-08-25 21:58:21.742 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Kommo CRM conectado: leonardofvieira00
‚ö†Ô∏è Rate Limiter: Usando burst para kommo
2025-08-25 21:58:22.269 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 9 campos customizados mapeados
‚ö†Ô∏è Rate Limiter: Usando burst para kommo
2025-08-25 21:58:22.835 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 30 varia√ß√µes de est√°gios mapeadas
2025-08-25 21:58:22.859 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Evolution API conectada: 1 inst√¢ncias
2025-08-25 21:58:22.859 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ AgenticSDR Stateless inicializado! pronto | Data: {'modules': ['ModelManager', 'MultimodalProcessor', 'LeadManager', 'ContextAnalyzer', 'CalendarService', 'CRMService', 'FollowUpService']}
2025-08-25 21:58:22.860 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ Agente stateless criado com contexto pronto | Data: {'history_count': 55, 'lead_name': 'Mateus M'}
2025-08-25 21:58:22.860 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è AGENTIC SDR Stateless pronto para uso
2025-08-25 21:58:22.860 | INFO     | app.utils.logger:log_with_emoji:75 | ü§ñ AGENTIC SDR: ü§ñ AGENTE STATELESS INICIADO - Mensagem: 'reagendar
j√° disse antes po
reagende a reuniao...'
2025-08-25 21:58:22.861 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Mensagem do usu√°rio registrada
2025-08-25 21:58:22.862 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Mensagem adicionada ao hist√≥rico. Total: 56 mensagens
2025-08-25 21:58:22.862 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Contexto analisado - Sentimento: {'enabled': True, 'sentiment': 'neutro', 'score': 0.0, 'confidence': 0.7}, Urg√™ncia: normal
2025-08-25 21:58:22.863 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Lead atualizado - Nome: 'Mateus M', Valor: 359.1
2025-08-25 21:58:22.863 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ CONTEXTO ATUALIZADO - Hist√≥rico e lead_info finalizados
2025-08-25 21:58:22.863 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Contexto atualizado - Lead: Mateus M, Hist√≥rico: 56 msgs
2025-08-25 21:58:22.863 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Sincroniza√ß√£o externa conclu√≠da
2025-08-25 21:58:22.864 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è CRM Sync: Payload de atualiza√ß√£o gerado. | Data: {'payload': {'chosen_flow': 'Compra com Desconto', 'name': 'Mateus M', 'bill_value': 359.1, 'phone': '558182986181', 'qualification_score': 35, 'tags': ['Compra com Desconto']}}
üö´ Rate Limiter: Bloqueando kommo. Aguarde 3.8s
‚è≥ Rate Limiter: Aguardando 4.8s para kommo...
2025-08-25 21:58:24.174 | ERROR    | app.utils.logger:log_with_emoji:75 | ‚ùå Erro Supabase: Erro ao buscar lead: Server disconnected | Data: {'table': 'leads'}
‚ö†Ô∏è Rate Limiter: Usando burst para kommo
INFO:     10.11.0.4:36326 - "POST /webhook/kommo/events HTTP/1.1" 200 OK
2025-08-25 21:58:28.375 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è CRM Sync: Dados do lead atualizados no Kommo. | Data: {'payload': {'chosen_flow': 'Compra com Desconto', 'name': 'Mateus M', 'bill_value': 359.1, 'phone': '558182986181', 'qualification_score': 35, 'tags': ['Compra com Desconto']}}
2025-08-25 21:58:28.375 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Dados CRM sincronizados
2025-08-25 21:58:36.402 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Resposta LLM gerada: '<RESPOSTA_FINAL>Claro, Mateus. A gente reagenda sem problema nenhum. Para qual dia e hor√°rio voc√™ go...'
2025-08-25 21:58:36.404 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Resposta do assistente registrada
2025-08-25 21:58:36.404 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ AGENTIC SUCCESS: ‚úÖ AGENTE STATELESS CONCLU√çDO - 558182986181: 'reagendar
j√° disse antes po
reagende a reuniao...' -> '<RESPOSTA_FINAL>Claro, Mateus. A gente reagenda se...'
2025-08-25 21:58:36.404 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Resposta gerada pelo agente: '<RESPOSTA_FINAL>Claro, Mateus. A gente reagenda sem problema nenhum. Para qual dia e hor√°rio voc√™ go...'
2025-08-25 21:58:37.884 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Resposta do assistente salva
2025-08-25 21:58:38.124 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Lead atualizado
INFO:     127.0.0.1:60574 - "GET /health HTTP/1.1" 200 OK
2025-08-25 21:58:46.723 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Evolution API - Typing enviado para 558182986181 (dura√ß√£o: 3.39s, tamanho: 116)
2025-08-25 21:58:52.172 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Evolution API - Mensagem de texto enviada para 558182986181 (tamanho: 116, delay: 5.0s)
2025-08-25 21:58:52.173 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Resposta enviada via WhatsApp
2025-08-25 21:58:52.174 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ PROCESSAMENTO PRINCIPAL CONCLU√çDO - 558182986181: 'reagendar
j√° disse antes po
reagende a reuniao...' -> 'Claro, Mateus. A gente reagenda sem problema nenhu...'
2025-08-25 21:58:53.066 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/messages-update de evolution-api | Data: {'event': 'MESSAGES_UPDATE', 'endpoint': '/whatsapp/messages-update', 'source': 'evolution-api'}
INFO:     10.11.0.4:37200 - "POST /webhook/evolution/messages-update HTTP/1.1" 200 OK
2025-08-25 21:58:56.594 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/presence-update de evolution-api | Data: {'event': 'PRESENCE_UPDATE', 'endpoint': '/whatsapp/presence-update', 'source': 'evolution-api'}
INFO:     10.11.0.4:37200 - "POST /webhook/evolution/presence-update HTTP/1.1" 200 OK
2025-08-25 21:59:01.015 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/chats-update de evolution-api | Data: {'event': 'CHATS_UPDATE', 'endpoint': '/whatsapp/chats-update', 'source': 'evolution-api'}
2025-08-25 21:59:01.016 | INFO     | app.api.webhooks:whatsapp_dynamic_webhook:761 | CHATS_UPDATE update recebido: {'event': 'chats.update', 'instance': 'SDR IA SolarPrime', 'data': [{'remoteJid': '558182986181@s.whatsapp.net', 'instanceId': '02f1c146-f8b8-4f19-9e8a-d3517ee84269'}], 'destination': 'https://sdr-api-evolution-api.fzvgou.easypanel.host/webhook/evolution', 'date_time': '2025-08-25T18:59:01.006Z', 'sender': '558195554978@s.whatsapp.net', 'server_url': 'https://evoapi-evolution-api.fzvgou.easypanel.host', 'apikey': '3ECB607589F3-4D35-949F-BA5D2D5892E9'}
INFO:     10.11.0.4:37200 - "POST /webhook/evolution/chats-update HTTP/1.1" 200 OK
2025-08-25 21:59:01.040 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/messages-upsert de evolution-api | Data: {'event': 'MESSAGES_UPSERT', 'endpoint': '/whatsapp/messages-upsert', 'source': 'evolution-api'}
INFO:     10.11.0.4:37200 - "POST /webhook/evolution/messages-upsert HTTP/1.1" 200 OK
2025-08-25 21:59:01.041 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è Iniciando processamento de 1 nova(s) mensagem(ns)
2025-08-25 21:59:01.041 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è Processando mensagem de 558182986181
2025-08-25 21:59:01.042 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Processando m√≠dia. Message key: {'remoteJid': '558182986181@s.whatsapp.net', 'fromMe': False, 'id': '3A3769C3FC66A9B4EFD7', 'senderLid': '129472024072320@lid'}
2025-08-25 21:59:01.042 | WARNING  | app.utils.logger:log_with_emoji:75 | ‚ö†Ô∏è Nenhum tipo de m√≠dia reconhecido encontrado no payload
2025-08-25 21:59:01.042 | INFO     | app.utils.logger:log_with_emoji:75 | üì• Recebido text de 558182986181 | Data: {'preview': 'para amanha as 10h por favor', 'sender': '558182986181', 'type': 'text'}
2025-08-25 21:59:01.272 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/contacts-update de evolution-api | Data: {'event': 'CONTACTS_UPDATE', 'endpoint': '/whatsapp/contacts-update', 'source': 'evolution-api'}
2025-08-25 21:59:01.272 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è === IN√çCIO AN√ÅLISE CONTACTS_UPDATE ===
2025-08-25 21:59:01.272 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Payload RAW completo:
{
  "event": "contacts.update",
  "instance": "SDR IA SolarPrime",
  "data": [
    {
      "remoteJid": "558182986181@s.whatsapp.net",
      "pushName": "Mateus M",
      "profilePicUrl": "https://pps.whatsapp.net/v/t61.24694-24/521428372_23966156116410343_3058739794538851299_n.jpg?ccb=11-4&oh=01_Q5Aa2QHA0accMmwVQ0kGQqxZWoRDME2SU5PBaDhuJ4XQqsHBkw&oe=68BA0A4D&_nc_sid=5e03e0&_nc_cat=104",
      "instanceId": "02f1c146-f8b8-4f19-9e8a-d3517ee84269"
    }
  ],
  "destination": "https://sdr-api-evolution-api.fzvgou.easypanel.host/webhook/evolution",
  "date_time": "2025-08-25T18:59:01.265Z",
  "sender": "558195554978@s.whatsapp.net",
  "server_url": "https://evoapi-evolution-api.fzvgou.easypanel.host",
  "apikey": "3ECB607589F3-4D35-949F-BA5D2D5892E9"
}
2025-08-25 21:59:01.272 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Tipo do payload: <class 'dict'>
2025-08-25 21:59:01.272 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Chaves do payload: ['event', 'instance', 'data', 'destination', 'date_time', 'sender', 'server_url', 'apikey']
2025-08-25 21:59:01.272 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è contact_data inicial: [
  {
    "remoteJid": "558182986181@s.whatsapp.net",
    "pushName": "Mateus M",
    "profilePicUrl": "https://pps.whatsapp.net/v/t61.24694-24/521428372_23966156116410343_3058739794538851299_n.jpg?ccb=11-4&oh=01_Q5Aa2QHA0accMmwVQ0kGQqxZWoRDME2SU5PBaDhuJ4XQqsHBkw&oe=68BA0A4D&_nc_sid=5e03e0&_nc_cat=104",
    "instanceId": "02f1c146-f8b8-4f19-9e8a-d3517ee84269"
  }
]
2025-08-25 21:59:01.272 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è contact_data √© lista com 1 itens
2025-08-25 21:59:01.273 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Usando primeiro item da lista: {
  "remoteJid": "558182986181@s.whatsapp.net",
  "pushName": "Mateus M",
  "profilePicUrl": "https://pps.whatsapp.net/v/t61.24694-24/521428372_23966156116410343_3058739794538851299_n.jpg?ccb=11-4&oh=01_Q5Aa2QHA0accMmwVQ0kGQqxZWoRDME2SU5PBaDhuJ4XQqsHBkw&oe=68BA0A4D&_nc_sid=5e03e0&_nc_cat=104",
  "instanceId": "02f1c146-f8b8-4f19-9e8a-d3517ee84269"
}
2025-08-25 21:59:01.273 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è contact_data final para processamento: {
  "remoteJid": "558182986181@s.whatsapp.net",
  "pushName": "Mateus M",
  "profilePicUrl": "https://pps.whatsapp.net/v/t61.24694-24/521428372_23966156116410343_3058739794538851299_n.jpg?ccb=11-4&oh=01_Q5Aa2QHA0accMmwVQ0kGQqxZWoRDME2SU5PBaDhuJ4XQqsHBkw&oe=68BA0A4D&_nc_sid=5e03e0&_nc_cat=104",
  "instanceId": "02f1c146-f8b8-4f19-9e8a-d3517ee84269"
}
2025-08-25 21:59:01.273 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Chaves dispon√≠veis em contact_data: ['remoteJid', 'pushName', 'profilePicUrl', 'instanceId']
2025-08-25 21:59:01.273 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è === IN√çCIO EXTRA√á√ÉO DE TELEFONE ===
2025-08-25 21:59:01.273 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Tentativa 0 - campo 'remoteJid' RAW: '558182986181@s.whatsapp.net'
2025-08-25 21:59:01.273 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Tentativa 0 - telefone extra√≠do de remoteJid: '558182986181'
2025-08-25 21:59:01.273 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è === RESULTADO FINAL DA EXTRA√á√ÉO ===
2025-08-25 21:59:01.274 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Telefone extra√≠do: '558182986181' (v√°lido: True)
2025-08-25 21:59:01.274 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è PushName extra√≠do: 'Mateus M' (v√°lido: True)
2025-08-25 21:59:01.274 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è === FIM AN√ÅLISE CONTACTS_UPDATE ===
2025-08-25 21:59:01.530 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Lead 558182986181 j√° possui nome 'Mateus M', n√£o sobrescrevendo com 'Mateus M'
INFO:     10.11.0.4:37200 - "POST /webhook/evolution/contacts-update HTTP/1.1" 200 OK
2025-08-25 21:59:01.532 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/contacts-update de evolution-api | Data: {'event': 'CONTACTS_UPDATE', 'endpoint': '/whatsapp/contacts-update', 'source': 'evolution-api'}
2025-08-25 21:59:01.532 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è üö´ CONTACTS_UPDATE ignorado - Duplicata detectada para 558182986181@s.whatsapp.net (processado h√° 0.3s)
INFO:     10.11.0.4:37210 - "POST /webhook/evolution/contacts-update HTTP/1.1" 200 OK
2025-08-25 21:59:02.451 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/messages-update de evolution-api | Data: {'event': 'MESSAGES_UPDATE', 'endpoint': '/whatsapp/messages-update', 'source': 'evolution-api'}
INFO:     10.11.0.4:37210 - "POST /webhook/evolution/messages-update HTTP/1.1" 200 OK
2025-08-25 21:59:02.451 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/chats-upsert de evolution-api | Data: {'event': 'CHATS_UPSERT', 'endpoint': '/whatsapp/chats-upsert', 'source': 'evolution-api'}
2025-08-25 21:59:02.452 | WARNING  | app.api.webhooks:whatsapp_dynamic_webhook:765 | Evento n√£o reconhecido: CHATS_UPSERT
INFO:     10.11.0.4:37200 - "POST /webhook/evolution/chats-upsert HTTP/1.1" 200 OK
2025-08-25 21:59:02.452 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è üîÑ Processando 1 mensagens combinadas para 558182986181 (total: 28 chars)
2025-08-25 21:59:02.453 | INFO     | app.utils.logger:log_with_emoji:75 | üí¨ üöÄ INICIANDO PROCESSAMENTO PRINCIPAL - Telefone: 558182986181, Mensagem: 'para amanha as 10h por favor...', ID: 3A3769C3FC66A9B4EFD7
2025-08-25 21:59:03.505 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/presence-update de evolution-api | Data: {'event': 'PRESENCE_UPDATE', 'endpoint': '/whatsapp/presence-update', 'source': 'evolution-api'}
INFO:     10.11.0.4:37210 - "POST /webhook/evolution/presence-update HTTP/1.1" 200 OK
2025-08-25 21:59:03.506 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Lead encontrado - ID: 9c2bb788-7efc-408c-859f-07669786b765, Nome: 'Mateus M'
2025-08-25 21:59:03.506 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Conversa encontrada - ID: 25d7c06b-a1b0-4e38-b38c-0ed491591677
2025-08-25 21:59:03.507 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Conversa validada - ID: 25d7c06b-a1b0-4e38-b38c-0ed491591677, Phone: 558182986181
2025-08-25 21:59:04.185 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/chats-update de evolution-api | Data: {'event': 'CHATS_UPDATE', 'endpoint': '/whatsapp/chats-update', 'source': 'evolution-api'}
2025-08-25 21:59:04.186 | INFO     | app.api.webhooks:whatsapp_dynamic_webhook:761 | CHATS_UPDATE update recebido: {'event': 'chats.update', 'instance': 'SDR IA SolarPrime', 'data': [{'remoteJid': '558182986181@s.whatsapp.net', 'instanceId': '02f1c146-f8b8-4f19-9e8a-d3517ee84269'}], 'destination': 'https://sdr-api-evolution-api.fzvgou.easypanel.host/webhook/evolution', 'date_time': '2025-08-25T18:59:04.104Z', 'sender': '558195554978@s.whatsapp.net', 'server_url': 'https://evoapi-evolution-api.fzvgou.easypanel.host', 'apikey': '3ECB607589F3-4D35-949F-BA5D2D5892E9'}
INFO:     10.11.0.4:37210 - "POST /webhook/evolution/chats-update HTTP/1.1" 200 OK
2025-08-25 21:59:04.187 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/messages-upsert de evolution-api | Data: {'event': 'MESSAGES_UPSERT', 'endpoint': '/whatsapp/messages-upsert', 'source': 'evolution-api'}
INFO:     10.11.0.4:37200 - "POST /webhook/evolution/messages-upsert HTTP/1.1" 200 OK
2025-08-25 21:59:04.187 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è Iniciando processamento de 1 nova(s) mensagem(ns)
2025-08-25 21:59:04.187 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è Processando mensagem de 558182986181
2025-08-25 21:59:04.188 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Processando m√≠dia. Message key: {'remoteJid': '558182986181@s.whatsapp.net', 'fromMe': False, 'id': '3AC72DB9B9BA5DDEBFB0', 'senderLid': '129472024072320@lid'}
2025-08-25 21:59:04.188 | WARNING  | app.utils.logger:log_with_emoji:75 | ‚ö†Ô∏è Nenhum tipo de m√≠dia reconhecido encontrado no payload
2025-08-25 21:59:04.188 | INFO     | app.utils.logger:log_with_emoji:75 | üì• Recebido text de 558182986181 | Data: {'preview': 'ah nao', 'sender': '558182986181', 'type': 'text'}
2025-08-25 21:59:04.190 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Mensagem e cache salvos
2025-08-25 21:59:04.190 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è Criando AGENTIC SDR Stateless...
2025-08-25 21:59:04.190 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è üè≠ Criando agente stateless com contexto...
2025-08-25 21:59:04.806 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/contacts-update de evolution-api | Data: {'event': 'CONTACTS_UPDATE', 'endpoint': '/whatsapp/contacts-update', 'source': 'evolution-api'}
2025-08-25 21:59:04.807 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è üö´ CONTACTS_UPDATE ignorado - Duplicata detectada para 558182986181@s.whatsapp.net (processado h√° 3.5s)
INFO:     10.11.0.4:37200 - "POST /webhook/evolution/contacts-update HTTP/1.1" 200 OK
2025-08-25 21:59:04.807 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/presence-update de evolution-api | Data: {'event': 'PRESENCE_UPDATE', 'endpoint': '/whatsapp/presence-update', 'source': 'evolution-api'}
INFO:     10.11.0.4:37210 - "POST /webhook/evolution/presence-update HTTP/1.1" 200 OK
2025-08-25 21:59:04.808 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/contacts-update de evolution-api | Data: {'event': 'CONTACTS_UPDATE', 'endpoint': '/whatsapp/contacts-update', 'source': 'evolution-api'}
2025-08-25 21:59:04.809 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è üö´ CONTACTS_UPDATE ignorado - Duplicata detectada para 558182986181@s.whatsapp.net (processado h√° 3.5s)
INFO:     10.11.0.4:60246 - "POST /webhook/evolution/contacts-update HTTP/1.1" 200 OK
2025-08-25 21:59:05.410 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Kommo CRM conectado: leonardofvieira00
2025-08-25 21:59:06.825 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/chats-update de evolution-api | Data: {'event': 'CHATS_UPDATE', 'endpoint': '/whatsapp/chats-update', 'source': 'evolution-api'}
2025-08-25 21:59:06.825 | INFO     | app.api.webhooks:whatsapp_dynamic_webhook:761 | CHATS_UPDATE update recebido: {'event': 'chats.update', 'instance': 'SDR IA SolarPrime', 'data': [{'remoteJid': '558182986181@s.whatsapp.net', 'instanceId': '02f1c146-f8b8-4f19-9e8a-d3517ee84269'}], 'destination': 'https://sdr-api-evolution-api.fzvgou.easypanel.host/webhook/evolution', 'date_time': '2025-08-25T18:59:06.817Z', 'sender': '558195554978@s.whatsapp.net', 'server_url': 'https://evoapi-evolution-api.fzvgou.easypanel.host', 'apikey': '3ECB607589F3-4D35-949F-BA5D2D5892E9'}
INFO:     10.11.0.4:60246 - "POST /webhook/evolution/chats-update HTTP/1.1" 200 OK
2025-08-25 21:59:06.839 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/messages-upsert de evolution-api | Data: {'event': 'MESSAGES_UPSERT', 'endpoint': '/whatsapp/messages-upsert', 'source': 'evolution-api'}
INFO:     10.11.0.4:60246 - "POST /webhook/evolution/messages-upsert HTTP/1.1" 200 OK
2025-08-25 21:59:06.840 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è Iniciando processamento de 1 nova(s) mensagem(ns)
2025-08-25 21:59:06.840 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è Processando mensagem de 558182986181
2025-08-25 21:59:06.841 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Processando m√≠dia. Message key: {'remoteJid': '558182986181@s.whatsapp.net', 'fromMe': False, 'id': '3A0E5546D7B7C3141E23', 'senderLid': '129472024072320@lid'}
2025-08-25 21:59:06.842 | WARNING  | app.utils.logger:log_with_emoji:75 | ‚ö†Ô∏è Nenhum tipo de m√≠dia reconhecido encontrado no payload
2025-08-25 21:59:06.842 | INFO     | app.utils.logger:log_with_emoji:75 | üì• Recebido text de 558182986181 | Data: {'preview': 'reagende para as 15h', 'sender': '558182986181', 'type': 'text'}
2025-08-25 21:59:07.075 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/contacts-update de evolution-api | Data: {'event': 'CONTACTS_UPDATE', 'endpoint': '/whatsapp/contacts-update', 'source': 'evolution-api'}
2025-08-25 21:59:07.076 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è üö´ CONTACTS_UPDATE ignorado - Duplicata detectada para 558182986181@s.whatsapp.net (processado h√° 5.8s)
INFO:     10.11.0.4:60246 - "POST /webhook/evolution/contacts-update HTTP/1.1" 200 OK
2025-08-25 21:59:07.115 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/contacts-update de evolution-api | Data: {'event': 'CONTACTS_UPDATE', 'endpoint': '/whatsapp/contacts-update', 'source': 'evolution-api'}
2025-08-25 21:59:07.115 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è üö´ CONTACTS_UPDATE ignorado - Duplicata detectada para 558182986181@s.whatsapp.net (processado h√° 5.8s)
INFO:     10.11.0.4:60246 - "POST /webhook/evolution/contacts-update HTTP/1.1" 200 OK
2025-08-25 21:59:07.482 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 9 campos customizados mapeados
2025-08-25 21:59:08.094 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 30 varia√ß√µes de est√°gios mapeadas
INFO:     127.0.0.1:45236 - "GET /health HTTP/1.1" 200 OK
2025-08-25 21:59:09.530 | INFO     | app.services.knowledge_service:__init__:24 | ‚úÖ KnowledgeService inicializado (vers√£o simplificada)
2025-08-25 21:59:09.531 | INFO     | app.utils.logger:log_with_emoji:75 | üöÄ Iniciando AgenticSDR Stateless
2025-08-25 21:59:09.531 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo prim√°rio Gemini configurado pronto | Data: {'model': 'gemini-2.5-pro'}
2025-08-25 21:59:09.540 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo fallback OpenAI configurado pronto | Data: {'model': 'o3-mini'}
2025-08-25 21:59:09.540 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo reasoning configurado pronto | Data: {'model': 'gemini-2.0-flash-thinking'}
2025-08-25 21:59:09.540 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Sistema de modelos configurado pronto | Data: {'primary_model': 'gemini-2.5-pro', 'fallback_available': True, 'reasoning_enabled': True}
2025-08-25 21:59:09.541 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üé® MultimodalProcessor habilitado pronto | Data: {'dependencies': {'ocr': True, 'audio': True, 'pdf': True}}
2025-08-25 21:59:09.541 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üìä LeadManager inicializado pronto
2025-08-25 21:59:09.541 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üß† ContextAnalyzer inicializado pronto
2025-08-25 21:59:09.541 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üìä ConversationMonitor inicializado pronto
2025-08-25 21:59:09.542 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è ‚úÖ ConversationMonitor: Loop iniciado
2025-08-25 21:59:09.544 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: ‚úÖ Servi√ßo Google Calendar constru√≠do com OAuth
2025-08-25 21:59:10.167 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: Google Calendar conectado via OAuth ao calend√°rio: 'leonardofvieira00@gmail.com' | Data: {'calendar_id': 'leonardofvieira00@gmail.com'}
2025-08-25 21:59:10.926 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Kommo CRM conectado: leonardofvieira00
‚ö†Ô∏è Rate Limiter: Usando burst para kommo
2025-08-25 21:59:11.485 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 9 campos customizados mapeados
‚ö†Ô∏è Rate Limiter: Usando burst para kommo
2025-08-25 21:59:12.032 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 30 varia√ß√µes de est√°gios mapeadas
2025-08-25 21:59:12.066 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Evolution API conectada: 1 inst√¢ncias
2025-08-25 21:59:12.067 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ AgenticSDR Stateless inicializado! pronto | Data: {'modules': ['ModelManager', 'MultimodalProcessor', 'LeadManager', 'ContextAnalyzer', 'CalendarService', 'CRMService', 'FollowUpService']}
2025-08-25 21:59:12.068 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ Agente stateless criado com contexto pronto | Data: {'history_count': 57, 'lead_name': 'Mateus M'}
2025-08-25 21:59:12.068 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è AGENTIC SDR Stateless pronto para uso
2025-08-25 21:59:12.068 | INFO     | app.utils.logger:log_with_emoji:75 | ü§ñ AGENTIC SDR: ü§ñ AGENTE STATELESS INICIADO - Mensagem: 'para amanha as 10h por favor...'
2025-08-25 21:59:12.069 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Mensagem do usu√°rio registrada
2025-08-25 21:59:12.069 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Mensagem adicionada ao hist√≥rico. Total: 58 mensagens
2025-08-25 21:59:12.070 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Contexto analisado - Sentimento: {'enabled': True, 'sentiment': 'neutro', 'score': 0.0, 'confidence': 0.7}, Urg√™ncia: normal
2025-08-25 21:59:12.071 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Lead atualizado - Nome: 'Mateus M', Valor: 359.1
2025-08-25 21:59:12.071 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ CONTEXTO ATUALIZADO - Hist√≥rico e lead_info finalizados
2025-08-25 21:59:12.071 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Contexto atualizado - Lead: Mateus M, Hist√≥rico: 58 msgs
2025-08-25 21:59:12.072 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Sincroniza√ß√£o externa conclu√≠da
2025-08-25 21:59:12.072 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è CRM Sync: Payload de atualiza√ß√£o gerado. | Data: {'payload': {'chosen_flow': 'Compra com Desconto', 'name': 'Mateus M', 'bill_value': 359.1, 'phone': '558182986181', 'qualification_score': 35, 'tags': ['Compra com Desconto']}}
üö´ Rate Limiter: Bloqueando kommo. Aguarde 2.7s
‚è≥ Rate Limiter: Aguardando 3.7s para kommo...
‚ö†Ô∏è Rate Limiter: Usando burst para kommo
INFO:     10.11.0.4:37302 - "POST /webhook/kommo/events HTTP/1.1" 200 OK
2025-08-25 21:59:16.425 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è CRM Sync: Dados do lead atualizados no Kommo. | Data: {'payload': {'chosen_flow': 'Compra com Desconto', 'name': 'Mateus M', 'bill_value': 359.1, 'phone': '558182986181', 'qualification_score': 35, 'tags': ['Compra com Desconto']}}
2025-08-25 21:59:16.425 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Dados CRM sincronizados
2025-08-25 21:59:25.718 | INFO     | app.utils.logger:log_with_emoji:75 | üìÖ Iniciando reagendamento para o lead: 9c2bb788-7efc-408c-859f-07669786b765
2025-08-25 21:59:25.966 | INFO     | app.utils.logger:log_with_emoji:75 | üìÖ Reuni√£o encontrada para reagendamento: fsb3omgv08pb24gks79sagj2i0
2025-08-25 21:59:26.192 | INFO     | app.utils.logger:log_with_emoji:75 | üìÖ Verificando disponibilidade interna para 2025-08-26 10:00...
2025-08-25 21:59:26.394 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Hor√°rio 10:00 est√° livre.
2025-08-25 21:59:26.394 | INFO     | app.utils.logger:log_with_emoji:75 | üìÖ Hor√°rio dispon√≠vel. Atualizando evento fsb3omgv08pb24gks79sagj2i0...
2025-08-25 21:59:26.871 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Reuni√£o fsb3omgv08pb24gks79sagj2i0 reagendada para 2025-08-26 √†s 10:00.
2025-08-25 21:59:27.464 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Qualifica√ß√£o 74bcb9ae-4e52-4841-88e2-898861d9a121 atualizada no Supabase.
2025-08-25 21:59:27.464 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ Tool executado: calendar.reschedule_meeting
2025-08-25 21:59:35.673 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Segunda chamada ao LLM bem-sucedida: <RESPOSTA_FINAL>Reuni√£o reagendada com sucesso, Ma...
2025-08-25 21:59:35.674 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Resposta LLM gerada: '<RESPOSTA_FINAL>Reuni√£o reagendada com sucesso, Mateus! Ficou para amanh√£, ter√ßa-feira, √†s 10h da ma...'
2025-08-25 21:59:35.675 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Resposta do assistente registrada
2025-08-25 21:59:35.675 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ AGENTIC SUCCESS: ‚úÖ AGENTE STATELESS CONCLU√çDO - 558182986181: 'para amanha as 10h por favor...' -> '<RESPOSTA_FINAL>Reuni√£o reagendada com sucesso, Ma...'
2025-08-25 21:59:35.675 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Resposta gerada pelo agente: '<RESPOSTA_FINAL>Reuni√£o reagendada com sucesso, Mateus! Ficou para amanh√£, ter√ßa-feira, √†s 10h da ma...'
2025-08-25 21:59:37.011 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Resposta do assistente salva
2025-08-25 21:59:37.232 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Lead atualizado
INFO:     127.0.0.1:44228 - "GET /health HTTP/1.1" 200 OK
2025-08-25 21:59:48.068 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Evolution API - Typing enviado para 558182986181 (dura√ß√£o: 5.42s, tamanho: 222)
2025-08-25 21:59:56.992 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Evolution API - Mensagem de texto enviada para 558182986181 (tamanho: 222, delay: 5.0s)
2025-08-25 21:59:56.992 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Resposta enviada via WhatsApp
2025-08-25 21:59:56.992 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ PROCESSAMENTO PRINCIPAL CONCLU√çDO - 558182986181: 'para amanha as 10h por favor...' -> 'Reuni√£o reagendada com sucesso, Mateus! Ficou para...'
2025-08-25 21:59:58.026 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/messages-update de evolution-api | Data: {'event': 'MESSAGES_UPDATE', 'endpoint': '/whatsapp/messages-update', 'source': 'evolution-api'}
INFO:     10.11.0.4:42732 - "POST /webhook/evolution/messages-update HTTP/1.1" 200 OK
INFO:     10.11.0.4:42732 - "POST /webhook/kommo/events HTTP/1.1" 200 OK
INFO:     10.11.0.4:42732 - "POST /webhook/kommo/events HTTP/1.1" 200 OK
INFO:     127.0.0.1:33616 - "GET /health HTTP/1.1" 200 OK