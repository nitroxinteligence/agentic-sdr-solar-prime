‚úÖ Usando vari√°veis de ambiente do servidor (EasyPanel)
2025-09-06 01:15:11.471 | INFO     | app.services.knowledge_service:__init__:24 | ‚úÖ KnowledgeService inicializado (vers√£o simplificada)
INFO:     Started server process [1]
INFO:     Waiting for application startup.
2025-09-06 01:15:11.505 | INFO     | app.utils.logger:log_with_emoji:75 | üöÄ Iniciando SDR IA Solar Prime v0.3
2025-09-06 01:15:11.515 | INFO     | app.integrations.redis_client:connect:35 | ‚úÖ Conectado ao Redis: redis_redis:6379
2025-09-06 01:15:11.515 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Redis pronto | Data: {'data': {'url': 'redis_redis:6379'}}
2025-09-06 01:15:11.758 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Supabase pronto
2025-09-06 01:15:11.758 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Buffer Inteligente inicializado (timeout=20.0s, max=10)
2025-09-06 01:15:11.758 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Message Buffer pronto | Data: {'data': {'timeout': '20.0s'}}
2025-09-06 01:15:11.758 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Message Splitter inicializado (max=250, smart=ativada)
2025-09-06 01:15:11.759 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Message Splitter pronto | Data: {'data': {'max_length': 250}}
2025-09-06 01:15:11.766 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üìä ConversationMonitor inicializado pronto
2025-09-06 01:15:11.766 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è ‚úÖ ConversationMonitor: Loop iniciado
2025-09-06 01:15:11.766 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Conversation Monitor pronto
2025-09-06 01:15:11.766 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Sistema Refatorado pronto | Data: {'data': {'modules': 'Core + Services'}}
2025-09-06 01:15:11.773 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ FollowUp Service pronto
2025-09-06 01:15:11.782 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ FollowUp Scheduler (Redis Mode) pronto
2025-09-06 01:15:11.782 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ FollowUp Scheduler pronto | Data: {'data': {'interval': '1800s'}}
2025-09-06 01:15:11.789 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üîê GoogleOAuthHandler inicializado
2025-09-06 01:15:11.796 | INFO     | app.services.knowledge_service:__init__:24 | ‚úÖ KnowledgeService inicializado (vers√£o simplificada)
2025-09-06 01:15:11.797 | INFO     | app.utils.logger:log_with_emoji:75 | üöÄ Iniciando AgenticSDR Stateless
2025-09-06 01:15:11.797 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo prim√°rio Gemini configurado pronto | Data: {'model': 'gemini-2.5-pro'}
2025-09-06 01:15:11.809 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo fallback OpenAI configurado pronto | Data: {'model': 'o3-mini'}
2025-09-06 01:15:11.810 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo reasoning configurado pronto | Data: {'model': 'gemini-2.0-flash-thinking'}
2025-09-06 01:15:11.810 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Sistema de modelos configurado pronto | Data: {'primary_model': 'gemini-2.5-pro', 'fallback_available': True, 'reasoning_enabled': True}
2025-09-06 01:15:11.810 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üé® MultimodalProcessor habilitado pronto | Data: {'dependencies': {'ocr': True, 'audio': True, 'pdf': True}}
2025-09-06 01:15:11.811 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üìä LeadManager inicializado pronto
2025-09-06 01:15:11.811 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üß† ContextAnalyzer inicializado pronto
2025-09-06 01:15:11.811 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üìä ConversationMonitor inicializado pronto
2025-09-06 01:15:11.812 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è ‚úÖ ConversationMonitor: Loop iniciado
2025-09-06 01:15:12.029 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üîÑ Access token renovado com sucesso
2025-09-06 01:15:12.056 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: ‚úÖ Servi√ßo Google Calendar constru√≠do com OAuth
2025-09-06 01:15:12.825 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: Google Calendar conectado via OAuth ao calend√°rio: 'leonardofvieira00@gmail.com' | Data: {'calendar_id': 'leonardofvieira00@gmail.com'}
2025-09-06 01:15:14.195 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Kommo CRM conectado: leonardofvieira00
2025-09-06 01:15:14.723 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 9 campos customizados mapeados
2025-09-06 01:15:15.292 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 30 varia√ß√µes de est√°gios mapeadas
2025-09-06 01:15:15.859 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Evolution API conectada: 1 inst√¢ncias
2025-09-06 01:15:15.859 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ AgenticSDR Stateless inicializado! pronto | Data: {'modules': ['ModelManager', 'MultimodalProcessor', 'LeadManager', 'ContextAnalyzer', 'CalendarService', 'CRMService', 'FollowUpService']}
2025-09-06 01:15:15.860 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ FollowUp Worker (Redis Mode) pronto
2025-09-06 01:15:15.861 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ FollowUp Worker pronto | Data: {'data': {'queue': 'followup_tasks'}}
2025-09-06 01:15:15.884 | INFO     | app.services.knowledge_service:__init__:24 | ‚úÖ KnowledgeService inicializado (vers√£o simplificada)
2025-09-06 01:15:15.884 | INFO     | app.utils.logger:log_with_emoji:75 | üöÄ Iniciando AgenticSDR Stateless
2025-09-06 01:15:15.885 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo prim√°rio Gemini configurado pronto | Data: {'model': 'gemini-2.5-pro'}
2025-09-06 01:15:15.916 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo fallback OpenAI configurado pronto | Data: {'model': 'o3-mini'}
2025-09-06 01:15:15.918 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo reasoning configurado pronto | Data: {'model': 'gemini-2.0-flash-thinking'}
2025-09-06 01:15:15.918 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Sistema de modelos configurado pronto | Data: {'primary_model': 'gemini-2.5-pro', 'fallback_available': True, 'reasoning_enabled': True}
2025-09-06 01:15:15.919 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üé® MultimodalProcessor habilitado pronto | Data: {'dependencies': {'ocr': True, 'audio': True, 'pdf': True}}
2025-09-06 01:15:15.919 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üìä LeadManager inicializado pronto
2025-09-06 01:15:15.920 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üß† ContextAnalyzer inicializado pronto
2025-09-06 01:15:15.920 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üìä ConversationMonitor inicializado pronto
2025-09-06 01:15:15.921 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è ‚úÖ ConversationMonitor: Loop iniciado
2025-09-06 01:15:15.939 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: ‚úÖ Servi√ßo Google Calendar constru√≠do com OAuth
2025-09-06 01:15:16.377 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: Google Calendar conectado via OAuth ao calend√°rio: 'leonardofvieira00@gmail.com' | Data: {'calendar_id': 'leonardofvieira00@gmail.com'}
2025-09-06 01:15:17.156 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Kommo CRM conectado: leonardofvieira00
2025-09-06 01:15:17.709 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 9 campos customizados mapeados
‚ö†Ô∏è Rate Limiter: Usando burst para kommo
2025-09-06 01:15:18.235 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 30 varia√ß√µes de est√°gios mapeadas
2025-09-06 01:15:18.277 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Evolution API conectada: 1 inst√¢ncias
2025-09-06 01:15:18.278 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ AgenticSDR Stateless inicializado! pronto | Data: {'modules': ['ModelManager', 'MultimodalProcessor', 'LeadManager', 'ContextAnalyzer', 'CalendarService', 'CRMService', 'FollowUpService']}
2025-09-06 01:15:18.278 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ AgenticSDR (Stateless) pronto | Data: {'data': {'status': 'sistema pronto'}}
2025-09-06 01:15:18.278 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ FollowUp Services pronto | Data: {'data': {'redis_workers': '‚úÖ Com Redis Workers'}}
2025-09-06 01:15:18.279 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ SDR IA Solar Prime pronto | Data: {'startup_ms': 6773.37}
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     127.0.0.1:41330 - "GET /health HTTP/1.1" 200 OK
INFO:     127.0.0.1:43458 - "GET /health HTTP/1.1" 200 OK
2025-09-06 01:16:18.345 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/presence-update de evolution-api | Data: {'event': 'PRESENCE_UPDATE', 'endpoint': '/whatsapp/presence-update', 'source': 'evolution-api'}
INFO:     10.11.0.4:60382 - "POST /webhook/evolution/presence-update HTTP/1.1" 200 OK
2025-09-06 01:16:19.018 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/chats-update de evolution-api | Data: {'event': 'CHATS_UPDATE', 'endpoint': '/whatsapp/chats-update', 'source': 'evolution-api'}
2025-09-06 01:16:19.018 | INFO     | app.api.webhooks:whatsapp_dynamic_webhook:780 | CHATS_UPDATE update recebido: {'event': 'chats.update', 'instance': 'SDR IA SolarPrime', 'data': [{'remoteJid': '558182986181@s.whatsapp.net', 'instanceId': '02f1c146-f8b8-4f19-9e8a-d3517ee84269'}, {'remoteJid': '558195554978@s.whatsapp.net', 'instanceId': '02f1c146-f8b8-4f19-9e8a-d3517ee84269'}], 'destination': 'https://sdr-api-evolution-api.fzvgou.easypanel.host/webhook/evolution', 'date_time': '2025-09-05T22:16:18.941Z', 'sender': '558195554978@s.whatsapp.net', 'server_url': 'https://evoapi-evolution-api.fzvgou.easypanel.host', 'apikey': '3ECB607589F3-4D35-949F-BA5D2D5892E9'}
INFO:     10.11.0.4:60382 - "POST /webhook/evolution/chats-update HTTP/1.1" 200 OK
2025-09-06 01:16:19.091 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/contacts-update de evolution-api | Data: {'event': 'CONTACTS_UPDATE', 'endpoint': '/whatsapp/contacts-update', 'source': 'evolution-api'}
2025-09-06 01:16:19.091 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è === IN√çCIO AN√ÅLISE CONTACTS_UPDATE ===
2025-09-06 01:16:19.091 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Payload RAW completo:
{
  "event": "contacts.update",
  "instance": "SDR IA SolarPrime",
  "data": [
    {
      "remoteJid": "558182986181@s.whatsapp.net",
      "pushName": "Mateus M",
      "profilePicUrl": "https://pps.whatsapp.net/v/t61.24694-24/521428372_23966156116410343_3058739794538851299_n.jpg?ccb=11-4&oh=01_Q5Aa2QG4yS_ZPoksHIXOPjGkOw6-hRw6FNnZ48nOGr4MsXojFw&oe=68C88ACD&_nc_sid=5e03e0&_nc_cat=104",
      "instanceId": "02f1c146-f8b8-4f19-9e8a-d3517ee84269"
    }
  ],
  "destination": "https://sdr-api-evolution-api.fzvgou.easypanel.host/webhook/evolution",
  "date_time": "2025-09-05T22:16:19.072Z",
  "sender": "558195554978@s.whatsapp.net",
  "server_url": "https://evoapi-evolution-api.fzvgou.easypanel.host",
  "apikey": "3ECB607589F3-4D35-949F-BA5D2D5892E9"
}
2025-09-06 01:16:19.091 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Tipo do payload: <class 'dict'>
2025-09-06 01:16:19.092 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Chaves do payload: ['event', 'instance', 'data', 'destination', 'date_time', 'sender', 'server_url', 'apikey']
2025-09-06 01:16:19.092 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è contact_data inicial: [
  {
    "remoteJid": "558182986181@s.whatsapp.net",
    "pushName": "Mateus M",
    "profilePicUrl": "https://pps.whatsapp.net/v/t61.24694-24/521428372_23966156116410343_3058739794538851299_n.jpg?ccb=11-4&oh=01_Q5Aa2QG4yS_ZPoksHIXOPjGkOw6-hRw6FNnZ48nOGr4MsXojFw&oe=68C88ACD&_nc_sid=5e03e0&_nc_cat=104",
    "instanceId": "02f1c146-f8b8-4f19-9e8a-d3517ee84269"
  }
]
2025-09-06 01:16:19.092 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è contact_data √© lista com 1 itens
2025-09-06 01:16:19.092 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Usando primeiro item da lista: {
  "remoteJid": "558182986181@s.whatsapp.net",
  "pushName": "Mateus M",
  "profilePicUrl": "https://pps.whatsapp.net/v/t61.24694-24/521428372_23966156116410343_3058739794538851299_n.jpg?ccb=11-4&oh=01_Q5Aa2QG4yS_ZPoksHIXOPjGkOw6-hRw6FNnZ48nOGr4MsXojFw&oe=68C88ACD&_nc_sid=5e03e0&_nc_cat=104",
  "instanceId": "02f1c146-f8b8-4f19-9e8a-d3517ee84269"
}
2025-09-06 01:16:19.092 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è contact_data final para processamento: {
  "remoteJid": "558182986181@s.whatsapp.net",
  "pushName": "Mateus M",
  "profilePicUrl": "https://pps.whatsapp.net/v/t61.24694-24/521428372_23966156116410343_3058739794538851299_n.jpg?ccb=11-4&oh=01_Q5Aa2QG4yS_ZPoksHIXOPjGkOw6-hRw6FNnZ48nOGr4MsXojFw&oe=68C88ACD&_nc_sid=5e03e0&_nc_cat=104",
  "instanceId": "02f1c146-f8b8-4f19-9e8a-d3517ee84269"
}
2025-09-06 01:16:19.092 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Chaves dispon√≠veis em contact_data: ['remoteJid', 'pushName', 'profilePicUrl', 'instanceId']
2025-09-06 01:16:19.092 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è === IN√çCIO EXTRA√á√ÉO DE TELEFONE ===
2025-09-06 01:16:19.092 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Tentativa 0 - campo 'remoteJid' RAW: '558182986181@s.whatsapp.net'
2025-09-06 01:16:19.093 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Tentativa 0 - telefone extra√≠do de remoteJid: '558182986181'
2025-09-06 01:16:19.093 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è === RESULTADO FINAL DA EXTRA√á√ÉO ===
2025-09-06 01:16:19.093 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Telefone extra√≠do: '558182986181' (v√°lido: True)
2025-09-06 01:16:19.093 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è PushName extra√≠do: 'Mateus M' (v√°lido: True)
2025-09-06 01:16:19.093 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è === FIM AN√ÅLISE CONTACTS_UPDATE ===
2025-09-06 01:16:19.330 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Lead 558182986181 j√° possui nome 'Mateus M', n√£o sobrescrevendo com 'Mateus M'
INFO:     10.11.0.4:60382 - "POST /webhook/evolution/contacts-update HTTP/1.1" 200 OK
2025-09-06 01:16:19.332 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/messages-upsert de evolution-api | Data: {'event': 'MESSAGES_UPSERT', 'endpoint': '/whatsapp/messages-upsert', 'source': 'evolution-api'}
INFO:     10.11.0.4:60390 - "POST /webhook/evolution/messages-upsert HTTP/1.1" 200 OK
2025-09-06 01:16:19.332 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è Iniciando processamento de 1 nova(s) mensagem(ns)
2025-09-06 01:16:19.333 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è Processando mensagem de 558182986181
2025-09-06 01:16:19.333 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Processando m√≠dia. Message key: {'remoteJid': '558182986181@s.whatsapp.net', 'fromMe': False, 'id': '3A843D99A1543C1D545C', 'senderLid': '129472024072320@lid'}
2025-09-06 01:16:19.333 | WARNING  | app.utils.logger:log_with_emoji:75 | ‚ö†Ô∏è Nenhum tipo de m√≠dia reconhecido encontrado no payload
2025-09-06 01:16:19.333 | INFO     | app.utils.logger:log_with_emoji:75 | üì• Recebido text de 558182986181 | Data: {'preview': 'oi?', 'sender': '558182986181', 'type': 'text'}
2025-09-06 01:16:19.334 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/contacts-update de evolution-api | Data: {'event': 'CONTACTS_UPDATE', 'endpoint': '/whatsapp/contacts-update', 'source': 'evolution-api'}
2025-09-06 01:16:19.334 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è üö´ CONTACTS_UPDATE ignorado - Duplicata detectada para 558182986181@s.whatsapp.net (processado h√° 0.2s)
INFO:     10.11.0.4:60402 - "POST /webhook/evolution/contacts-update HTTP/1.1" 200 OK
2025-09-06 01:16:20.337 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è üîÑ Processando 1 mensagens combinadas para 558182986181 (total: 3 chars)
2025-09-06 01:16:20.338 | INFO     | app.utils.logger:log_with_emoji:75 | üí¨ üöÄ INICIANDO PROCESSAMENTO PRINCIPAL - Telefone: 558182986181, Mensagem: 'oi?...', ID: 3A843D99A1543C1D545C
2025-09-06 01:16:21.057 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/messages-update de evolution-api | Data: {'event': 'MESSAGES_UPDATE', 'endpoint': '/whatsapp/messages-update', 'source': 'evolution-api'}
INFO:     10.11.0.4:60402 - "POST /webhook/evolution/messages-update HTTP/1.1" 200 OK
2025-09-06 01:16:21.057 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/chats-upsert de evolution-api | Data: {'event': 'CHATS_UPSERT', 'endpoint': '/whatsapp/chats-upsert', 'source': 'evolution-api'}
2025-09-06 01:16:21.058 | WARNING  | app.api.webhooks:whatsapp_dynamic_webhook:784 | Evento n√£o reconhecido: CHATS_UPSERT
INFO:     10.11.0.4:60390 - "POST /webhook/evolution/chats-upsert HTTP/1.1" 200 OK
2025-09-06 01:16:21.058 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Lead encontrado - ID: ed59d1e3-ff55-4737-a336-23d2b25d55c5, Nome: 'Mateus M'
2025-09-06 01:16:21.058 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Conversa encontrada - ID: f0faa62a-55a3-4bd3-9bce-99b299d0a9d5
2025-09-06 01:16:21.058 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Conversa validada - ID: f0faa62a-55a3-4bd3-9bce-99b299d0a9d5, Phone: 558182986181
INFO:     127.0.0.1:53666 - "GET /health HTTP/1.1" 200 OK
2025-09-06 01:16:22.101 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Mensagem e cache salvos
2025-09-06 01:16:22.101 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è Criando AGENTIC SDR Stateless...
2025-09-06 01:16:22.101 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è üè≠ Criando agente stateless com contexto...
2025-09-06 01:16:23.228 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Kommo CRM conectado: leonardofvieira00
2025-09-06 01:16:23.782 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 9 campos customizados mapeados
2025-09-06 01:16:24.335 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 30 varia√ß√µes de est√°gios mapeadas
2025-09-06 01:16:25.341 | INFO     | app.services.knowledge_service:__init__:24 | ‚úÖ KnowledgeService inicializado (vers√£o simplificada)
2025-09-06 01:16:25.341 | INFO     | app.utils.logger:log_with_emoji:75 | üöÄ Iniciando AgenticSDR Stateless
2025-09-06 01:16:25.341 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo prim√°rio Gemini configurado pronto | Data: {'model': 'gemini-2.5-pro'}
2025-09-06 01:16:25.350 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo fallback OpenAI configurado pronto | Data: {'model': 'o3-mini'}
2025-09-06 01:16:25.350 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo reasoning configurado pronto | Data: {'model': 'gemini-2.0-flash-thinking'}
2025-09-06 01:16:25.350 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Sistema de modelos configurado pronto | Data: {'primary_model': 'gemini-2.5-pro', 'fallback_available': True, 'reasoning_enabled': True}
2025-09-06 01:16:25.350 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üé® MultimodalProcessor habilitado pronto | Data: {'dependencies': {'ocr': True, 'audio': True, 'pdf': True}}
2025-09-06 01:16:25.350 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üìä LeadManager inicializado pronto
2025-09-06 01:16:25.351 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üß† ContextAnalyzer inicializado pronto
2025-09-06 01:16:25.351 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üìä ConversationMonitor inicializado pronto
2025-09-06 01:16:25.351 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è ‚úÖ ConversationMonitor: Loop iniciado
2025-09-06 01:16:25.354 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: ‚úÖ Servi√ßo Google Calendar constru√≠do com OAuth
2025-09-06 01:16:26.192 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: Google Calendar conectado via OAuth ao calend√°rio: 'leonardofvieira00@gmail.com' | Data: {'calendar_id': 'leonardofvieira00@gmail.com'}
2025-09-06 01:16:27.377 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Kommo CRM conectado: leonardofvieira00
‚ö†Ô∏è Rate Limiter: Usando burst para kommo
2025-09-06 01:16:27.955 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 9 campos customizados mapeados
‚ö†Ô∏è Rate Limiter: Usando burst para kommo
2025-09-06 01:16:28.511 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 30 varia√ß√µes de est√°gios mapeadas
2025-09-06 01:16:28.544 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Evolution API conectada: 1 inst√¢ncias
2025-09-06 01:16:28.545 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ AgenticSDR Stateless inicializado! pronto | Data: {'modules': ['ModelManager', 'MultimodalProcessor', 'LeadManager', 'ContextAnalyzer', 'CalendarService', 'CRMService', 'FollowUpService']}
2025-09-06 01:16:28.546 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ Agente stateless criado com contexto pronto | Data: {'history_count': 19, 'lead_name': 'Mateus M'}
2025-09-06 01:16:28.546 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è AGENTIC SDR Stateless pronto para uso
2025-09-06 01:16:28.546 | INFO     | app.utils.logger:log_with_emoji:75 | ü§ñ AGENTIC SDR: ü§ñ AGENTE STATELESS INICIADO - Mensagem: 'oi?...'
2025-09-06 01:16:28.547 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Mensagem do usu√°rio registrada
2025-09-06 01:16:28.548 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Mensagem adicionada ao hist√≥rico. Total: 20 mensagens
2025-09-06 01:16:28.548 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Contexto analisado - Sentimento: {'enabled': True, 'sentiment': 'neutro', 'score': 0.0, 'confidence': 0.7}, Urg√™ncia: normal
2025-09-06 01:16:28.549 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Lead atualizado - Nome: 'Mateus M', Valor: 500.0
2025-09-06 01:16:28.549 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ CONTEXTO ATUALIZADO - Hist√≥rico e lead_info finalizados
2025-09-06 01:16:28.549 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Contexto atualizado - Lead: Mateus M, Hist√≥rico: 20 msgs
2025-09-06 01:16:28.549 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Sincroniza√ß√£o externa conclu√≠da
2025-09-06 01:16:28.550 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è CRM Sync: Payload de atualiza√ß√£o gerado. | Data: {'payload': {'chosen_flow': 'Compra com Desconto', 'name': 'Mateus M', 'bill_value': 500.0, 'phone': '558182986181', 'qualification_score': 40, 'tags': ['Compra com Desconto']}}
üö´ Rate Limiter: Bloqueando kommo. Aguarde 4.1s
‚è≥ Rate Limiter: Aguardando 5.1s para kommo...
‚ö†Ô∏è Rate Limiter: Usando burst para kommo
2025-09-06 01:16:34.330 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è CRM Sync: Dados do lead atualizados no Kommo. | Data: {'payload': {'chosen_flow': 'Compra com Desconto', 'name': 'Mateus M', 'bill_value': 500.0, 'phone': '558182986181', 'qualification_score': 40, 'tags': ['Compra com Desconto']}}
2025-09-06 01:16:34.330 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Dados CRM sincronizados
INFO:     10.11.0.4:54168 - "POST /webhook/kommo/events HTTP/1.1" 200 OK
2025-09-06 01:16:48.765 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Resposta LLM gerada: '<RESPOSTA_FINAL>Estou por aqui, Mateus. A gente estava combinando sua reuni√£o para segunda-feira. Vo...'
2025-09-06 01:16:48.766 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Resposta do assistente registrada
2025-09-06 01:16:48.766 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ AGENTIC SUCCESS: ‚úÖ AGENTE STATELESS CONCLU√çDO - 558182986181: 'oi?...' -> '<RESPOSTA_FINAL>Estou por aqui, Mateus. A gente es...'
2025-09-06 01:16:48.766 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Resposta gerada pelo agente: '<RESPOSTA_FINAL>Estou por aqui, Mateus. A gente estava combinando sua reuni√£o para segunda-feira. Vo...'
2025-09-06 01:16:50.113 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Resposta do assistente salva
2025-09-06 01:16:50.355 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Lead atualizado
INFO:     127.0.0.1:45828 - "GET /health HTTP/1.1" 200 OK
2025-09-06 01:16:58.366 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Evolution API - Typing enviado para 558182986181 (dura√ß√£o: 2.6s, tamanho: 137)
2025-09-06 01:17:02.819 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Evolution API - Mensagem de texto enviada para 558182986181 (tamanho: 137, delay: 5.0s)
2025-09-06 01:17:02.820 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Resposta enviada via WhatsApp
2025-09-06 01:17:02.820 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ PROCESSAMENTO PRINCIPAL CONCLU√çDO - 558182986181: 'oi?...' -> 'Estou por aqui, Mateus. A gente estava combinando ...'