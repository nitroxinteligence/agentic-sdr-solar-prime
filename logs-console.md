‚úÖ Usando vari√°veis de ambiente do servidor (EasyPanel)
2025-09-06 01:28:32.622 | INFO     | app.services.knowledge_service:__init__:24 | ‚úÖ KnowledgeService inicializado (vers√£o simplificada)
INFO:     Started server process [1]
INFO:     Waiting for application startup.
2025-09-06 01:28:32.651 | INFO     | app.utils.logger:log_with_emoji:75 | üöÄ Iniciando SDR IA Solar Prime v0.3
2025-09-06 01:28:32.655 | INFO     | app.integrations.redis_client:connect:35 | ‚úÖ Conectado ao Redis: redis_redis:6379
2025-09-06 01:28:32.655 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Redis pronto | Data: {'data': {'url': 'redis_redis:6379'}}
2025-09-06 01:28:32.920 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Supabase pronto
2025-09-06 01:28:32.920 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Buffer Inteligente inicializado (timeout=20.0s, max=10)
2025-09-06 01:28:32.921 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Message Buffer pronto | Data: {'data': {'timeout': '20.0s'}}
2025-09-06 01:28:32.921 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Message Splitter inicializado (max=250, smart=ativada)
2025-09-06 01:28:32.921 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Message Splitter pronto | Data: {'data': {'max_length': 250}}
2025-09-06 01:28:32.928 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üìä ConversationMonitor inicializado pronto
2025-09-06 01:28:32.929 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è ‚úÖ ConversationMonitor: Loop iniciado
2025-09-06 01:28:32.929 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Conversation Monitor pronto
2025-09-06 01:28:32.929 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Sistema Refatorado pronto | Data: {'data': {'modules': 'Core + Services'}}
2025-09-06 01:28:32.936 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ FollowUp Service pronto
2025-09-06 01:28:32.945 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ FollowUp Scheduler (Redis Mode) pronto
2025-09-06 01:28:32.945 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ FollowUp Scheduler pronto | Data: {'data': {'interval': '1800s'}}
2025-09-06 01:28:32.953 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üîê GoogleOAuthHandler inicializado
2025-09-06 01:28:32.961 | INFO     | app.services.knowledge_service:__init__:24 | ‚úÖ KnowledgeService inicializado (vers√£o simplificada)
2025-09-06 01:28:32.961 | INFO     | app.utils.logger:log_with_emoji:75 | üöÄ Iniciando AgenticSDR Stateless
2025-09-06 01:28:32.962 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo prim√°rio Gemini configurado pronto | Data: {'model': 'gemini-2.5-pro'}
2025-09-06 01:28:32.969 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo fallback OpenAI configurado pronto | Data: {'model': 'o3-mini'}
2025-09-06 01:28:32.970 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo reasoning configurado pronto | Data: {'model': 'gemini-2.0-flash-thinking'}
2025-09-06 01:28:32.970 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Sistema de modelos configurado pronto | Data: {'primary_model': 'gemini-2.5-pro', 'fallback_available': True, 'reasoning_enabled': True}
2025-09-06 01:28:32.971 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üé® MultimodalProcessor habilitado pronto | Data: {'dependencies': {'ocr': True, 'audio': True, 'pdf': True}}
2025-09-06 01:28:32.971 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üìä LeadManager inicializado pronto
2025-09-06 01:28:32.971 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üß† ContextAnalyzer inicializado pronto
2025-09-06 01:28:32.971 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üìä ConversationMonitor inicializado pronto
2025-09-06 01:28:32.971 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è ‚úÖ ConversationMonitor: Loop iniciado
2025-09-06 01:28:33.179 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üîÑ Access token renovado com sucesso
2025-09-06 01:28:33.183 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: ‚úÖ Servi√ßo Google Calendar constru√≠do com OAuth
2025-09-06 01:28:33.455 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: Google Calendar conectado via OAuth ao calend√°rio: 'leonardofvieira00@gmail.com' | Data: {'calendar_id': 'leonardofvieira00@gmail.com'}
2025-09-06 01:28:34.832 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Kommo CRM conectado: leonardofvieira00
2025-09-06 01:28:36.538 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 9 campos customizados mapeados
2025-09-06 01:28:37.091 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 30 varia√ß√µes de est√°gios mapeadas
2025-09-06 01:28:37.116 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Evolution API conectada: 1 inst√¢ncias
2025-09-06 01:28:37.117 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ AgenticSDR Stateless inicializado! pronto | Data: {'modules': ['ModelManager', 'MultimodalProcessor', 'LeadManager', 'ContextAnalyzer', 'CalendarService', 'CRMService', 'FollowUpService']}
2025-09-06 01:28:37.117 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ FollowUp Worker (Redis Mode) pronto
2025-09-06 01:28:37.118 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ FollowUp Worker pronto | Data: {'data': {'queue': 'followup_tasks'}}
2025-09-06 01:28:37.126 | INFO     | app.services.knowledge_service:__init__:24 | ‚úÖ KnowledgeService inicializado (vers√£o simplificada)
2025-09-06 01:28:37.126 | INFO     | app.utils.logger:log_with_emoji:75 | üöÄ Iniciando AgenticSDR Stateless
2025-09-06 01:28:37.126 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo prim√°rio Gemini configurado pronto | Data: {'model': 'gemini-2.5-pro'}
2025-09-06 01:28:37.133 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo fallback OpenAI configurado pronto | Data: {'model': 'o3-mini'}
2025-09-06 01:28:37.133 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo reasoning configurado pronto | Data: {'model': 'gemini-2.0-flash-thinking'}
2025-09-06 01:28:37.134 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Sistema de modelos configurado pronto | Data: {'primary_model': 'gemini-2.5-pro', 'fallback_available': True, 'reasoning_enabled': True}
2025-09-06 01:28:37.134 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üé® MultimodalProcessor habilitado pronto | Data: {'dependencies': {'ocr': True, 'audio': True, 'pdf': True}}
2025-09-06 01:28:37.134 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üìä LeadManager inicializado pronto
2025-09-06 01:28:37.134 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üß† ContextAnalyzer inicializado pronto
2025-09-06 01:28:37.134 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üìä ConversationMonitor inicializado pronto
2025-09-06 01:28:37.134 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è ‚úÖ ConversationMonitor: Loop iniciado
2025-09-06 01:28:37.137 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: ‚úÖ Servi√ßo Google Calendar constru√≠do com OAuth
2025-09-06 01:28:37.599 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: Google Calendar conectado via OAuth ao calend√°rio: 'leonardofvieira00@gmail.com' | Data: {'calendar_id': 'leonardofvieira00@gmail.com'}
2025-09-06 01:28:38.730 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Kommo CRM conectado: leonardofvieira00
2025-09-06 01:28:39.240 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 9 campos customizados mapeados
‚ö†Ô∏è Rate Limiter: Usando burst para kommo
2025-09-06 01:28:39.756 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 30 varia√ß√µes de est√°gios mapeadas
2025-09-06 01:28:39.775 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Evolution API conectada: 1 inst√¢ncias
2025-09-06 01:28:39.776 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ AgenticSDR Stateless inicializado! pronto | Data: {'modules': ['ModelManager', 'MultimodalProcessor', 'LeadManager', 'ContextAnalyzer', 'CalendarService', 'CRMService', 'FollowUpService']}
2025-09-06 01:28:39.776 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ AgenticSDR (Stateless) pronto | Data: {'data': {'status': 'sistema pronto'}}
2025-09-06 01:28:39.776 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ FollowUp Services pronto | Data: {'data': {'redis_workers': '‚úÖ Com Redis Workers'}}
2025-09-06 01:28:39.776 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ SDR IA Solar Prime pronto | Data: {'startup_ms': 7125.35}
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     127.0.0.1:38406 - "GET /health HTTP/1.1" 200 OK
2025-09-06 01:29:10.343 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/presence-update de evolution-api | Data: {'event': 'PRESENCE_UPDATE', 'endpoint': '/whatsapp/presence-update', 'source': 'evolution-api'}
INFO:     10.11.0.4:51382 - "POST /webhook/evolution/presence-update HTTP/1.1" 200 OK
2025-09-06 01:29:10.726 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/chats-update de evolution-api | Data: {'event': 'CHATS_UPDATE', 'endpoint': '/whatsapp/chats-update', 'source': 'evolution-api'}
2025-09-06 01:29:10.726 | INFO     | app.api.webhooks:whatsapp_dynamic_webhook:780 | CHATS_UPDATE update recebido: {'event': 'chats.update', 'instance': 'SDR IA SolarPrime', 'data': [{'remoteJid': '558182986181@s.whatsapp.net', 'instanceId': '02f1c146-f8b8-4f19-9e8a-d3517ee84269'}], 'destination': 'https://sdr-api-evolution-api.fzvgou.easypanel.host/webhook/evolution', 'date_time': '2025-09-05T22:29:10.718Z', 'sender': '558195554978@s.whatsapp.net', 'server_url': 'https://evoapi-evolution-api.fzvgou.easypanel.host', 'apikey': '3ECB607589F3-4D35-949F-BA5D2D5892E9'}
INFO:     10.11.0.4:51382 - "POST /webhook/evolution/chats-update HTTP/1.1" 200 OK
2025-09-06 01:29:10.746 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/chats-update de evolution-api | Data: {'event': 'CHATS_UPDATE', 'endpoint': '/whatsapp/chats-update', 'source': 'evolution-api'}
2025-09-06 01:29:10.746 | INFO     | app.api.webhooks:whatsapp_dynamic_webhook:780 | CHATS_UPDATE update recebido: {'event': 'chats.update', 'instance': 'SDR IA SolarPrime', 'data': [{'remoteJid': '558195554978@s.whatsapp.net', 'instanceId': '02f1c146-f8b8-4f19-9e8a-d3517ee84269'}], 'destination': 'https://sdr-api-evolution-api.fzvgou.easypanel.host/webhook/evolution', 'date_time': '2025-09-05T22:29:10.730Z', 'sender': '558195554978@s.whatsapp.net', 'server_url': 'https://evoapi-evolution-api.fzvgou.easypanel.host', 'apikey': '3ECB607589F3-4D35-949F-BA5D2D5892E9'}
INFO:     10.11.0.4:51382 - "POST /webhook/evolution/chats-update HTTP/1.1" 200 OK
2025-09-06 01:29:10.759 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/messages-upsert de evolution-api | Data: {'event': 'MESSAGES_UPSERT', 'endpoint': '/whatsapp/messages-upsert', 'source': 'evolution-api'}
INFO:     10.11.0.4:51382 - "POST /webhook/evolution/messages-upsert HTTP/1.1" 200 OK
2025-09-06 01:29:10.759 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è Iniciando processamento de 1 nova(s) mensagem(ns)
2025-09-06 01:29:10.760 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è Processando mensagem de 558182986181
2025-09-06 01:29:10.760 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Processando m√≠dia. Message key: {'remoteJid': '558182986181@s.whatsapp.net', 'fromMe': False, 'id': '3A9ECE9A3D0974590849', 'senderLid': '129472024072320@lid'}
2025-09-06 01:29:10.760 | WARNING  | app.utils.logger:log_with_emoji:75 | ‚ö†Ô∏è Nenhum tipo de m√≠dia reconhecido encontrado no payload
2025-09-06 01:29:10.760 | INFO     | app.utils.logger:log_with_emoji:75 | üì• Recebido text de 558182986181 | Data: {'preview': 'oi?', 'sender': '558182986181', 'type': 'text'}
2025-09-06 01:29:10.851 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/contacts-update de evolution-api | Data: {'event': 'CONTACTS_UPDATE', 'endpoint': '/whatsapp/contacts-update', 'source': 'evolution-api'}
2025-09-06 01:29:10.851 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è === IN√çCIO AN√ÅLISE CONTACTS_UPDATE ===
2025-09-06 01:29:10.851 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Payload RAW completo:
{
  "event": "contacts.update",
  "instance": "SDR IA SolarPrime",
  "data": [
    {
      "remoteJid": "558182986181@s.whatsapp.net",
      "pushName": "Mateus M",
      "profilePicUrl": "https://pps.whatsapp.net/v/t61.24694-24/521428372_23966156116410343_3058739794538851299_n.jpg?ccb=11-4&oh=01_Q5Aa2QG4yS_ZPoksHIXOPjGkOw6-hRw6FNnZ48nOGr4MsXojFw&oe=68C88ACD&_nc_sid=5e03e0&_nc_cat=104",
      "instanceId": "02f1c146-f8b8-4f19-9e8a-d3517ee84269"
    }
  ],
  "destination": "https://sdr-api-evolution-api.fzvgou.easypanel.host/webhook/evolution",
  "date_time": "2025-09-05T22:29:10.843Z",
  "sender": "558195554978@s.whatsapp.net",
  "server_url": "https://evoapi-evolution-api.fzvgou.easypanel.host",
  "apikey": "3ECB607589F3-4D35-949F-BA5D2D5892E9"
}
2025-09-06 01:29:10.852 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Tipo do payload: <class 'dict'>
2025-09-06 01:29:10.852 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Chaves do payload: ['event', 'instance', 'data', 'destination', 'date_time', 'sender', 'server_url', 'apikey']
2025-09-06 01:29:10.852 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è contact_data inicial: [
  {
    "remoteJid": "558182986181@s.whatsapp.net",
    "pushName": "Mateus M",
    "profilePicUrl": "https://pps.whatsapp.net/v/t61.24694-24/521428372_23966156116410343_3058739794538851299_n.jpg?ccb=11-4&oh=01_Q5Aa2QG4yS_ZPoksHIXOPjGkOw6-hRw6FNnZ48nOGr4MsXojFw&oe=68C88ACD&_nc_sid=5e03e0&_nc_cat=104",
    "instanceId": "02f1c146-f8b8-4f19-9e8a-d3517ee84269"
  }
]
2025-09-06 01:29:10.852 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è contact_data √© lista com 1 itens
2025-09-06 01:29:10.852 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Usando primeiro item da lista: {
  "remoteJid": "558182986181@s.whatsapp.net",
  "pushName": "Mateus M",
  "profilePicUrl": "https://pps.whatsapp.net/v/t61.24694-24/521428372_23966156116410343_3058739794538851299_n.jpg?ccb=11-4&oh=01_Q5Aa2QG4yS_ZPoksHIXOPjGkOw6-hRw6FNnZ48nOGr4MsXojFw&oe=68C88ACD&_nc_sid=5e03e0&_nc_cat=104",
  "instanceId": "02f1c146-f8b8-4f19-9e8a-d3517ee84269"
}
2025-09-06 01:29:10.852 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è contact_data final para processamento: {
  "remoteJid": "558182986181@s.whatsapp.net",
  "pushName": "Mateus M",
  "profilePicUrl": "https://pps.whatsapp.net/v/t61.24694-24/521428372_23966156116410343_3058739794538851299_n.jpg?ccb=11-4&oh=01_Q5Aa2QG4yS_ZPoksHIXOPjGkOw6-hRw6FNnZ48nOGr4MsXojFw&oe=68C88ACD&_nc_sid=5e03e0&_nc_cat=104",
  "instanceId": "02f1c146-f8b8-4f19-9e8a-d3517ee84269"
}
2025-09-06 01:29:10.852 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Chaves dispon√≠veis em contact_data: ['remoteJid', 'pushName', 'profilePicUrl', 'instanceId']
2025-09-06 01:29:10.852 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è === IN√çCIO EXTRA√á√ÉO DE TELEFONE ===
2025-09-06 01:29:10.852 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Tentativa 0 - campo 'remoteJid' RAW: '558182986181@s.whatsapp.net'
2025-09-06 01:29:10.853 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Tentativa 0 - telefone extra√≠do de remoteJid: '558182986181'
2025-09-06 01:29:10.853 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è === RESULTADO FINAL DA EXTRA√á√ÉO ===
2025-09-06 01:29:10.853 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Telefone extra√≠do: '558182986181' (v√°lido: True)
2025-09-06 01:29:10.853 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è PushName extra√≠do: 'Mateus M' (v√°lido: True)
2025-09-06 01:29:10.853 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è === FIM AN√ÅLISE CONTACTS_UPDATE ===
2025-09-06 01:29:11.277 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Lead 558182986181 j√° possui nome 'Mateus M', n√£o sobrescrevendo com 'Mateus M'
INFO:     10.11.0.4:51382 - "POST /webhook/evolution/contacts-update HTTP/1.1" 200 OK
2025-09-06 01:29:11.279 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/contacts-update de evolution-api | Data: {'event': 'CONTACTS_UPDATE', 'endpoint': '/whatsapp/contacts-update', 'source': 'evolution-api'}
2025-09-06 01:29:11.280 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è üö´ CONTACTS_UPDATE ignorado - Duplicata detectada para 558182986181@s.whatsapp.net (processado h√° 0.4s)
INFO:     10.11.0.4:51394 - "POST /webhook/evolution/contacts-update HTTP/1.1" 200 OK
2025-09-06 01:29:11.763 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è üîÑ Processando 1 mensagens combinadas para 558182986181 (total: 3 chars)
2025-09-06 01:29:11.763 | INFO     | app.utils.logger:log_with_emoji:75 | üí¨ üöÄ INICIANDO PROCESSAMENTO PRINCIPAL - Telefone: 558182986181, Mensagem: 'oi?...', ID: 3A9ECE9A3D0974590849
2025-09-06 01:29:12.451 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/messages-update de evolution-api | Data: {'event': 'MESSAGES_UPDATE', 'endpoint': '/whatsapp/messages-update', 'source': 'evolution-api'}
INFO:     10.11.0.4:51394 - "POST /webhook/evolution/messages-update HTTP/1.1" 200 OK
2025-09-06 01:29:12.452 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/chats-upsert de evolution-api | Data: {'event': 'CHATS_UPSERT', 'endpoint': '/whatsapp/chats-upsert', 'source': 'evolution-api'}
2025-09-06 01:29:12.452 | WARNING  | app.api.webhooks:whatsapp_dynamic_webhook:784 | Evento n√£o reconhecido: CHATS_UPSERT
INFO:     10.11.0.4:51382 - "POST /webhook/evolution/chats-upsert HTTP/1.1" 200 OK
2025-09-06 01:29:12.452 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Lead encontrado - ID: ed59d1e3-ff55-4737-a336-23d2b25d55c5, Nome: 'Mateus M'
2025-09-06 01:29:12.453 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Conversa encontrada - ID: f0faa62a-55a3-4bd3-9bce-99b299d0a9d5
2025-09-06 01:29:12.453 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Conversa validada - ID: f0faa62a-55a3-4bd3-9bce-99b299d0a9d5, Phone: 558182986181
2025-09-06 01:29:13.106 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Mensagem e cache salvos
2025-09-06 01:29:13.107 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è Criando AGENTIC SDR Stateless...
2025-09-06 01:29:13.107 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è üè≠ Criando agente stateless com contexto...
2025-09-06 01:29:13.884 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Kommo CRM conectado: leonardofvieira00
2025-09-06 01:29:14.456 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 9 campos customizados mapeados
INFO:     127.0.0.1:39362 - "GET /health HTTP/1.1" 200 OK
2025-09-06 01:29:14.980 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 30 varia√ß√µes de est√°gios mapeadas
2025-09-06 01:29:15.997 | INFO     | app.services.knowledge_service:__init__:24 | ‚úÖ KnowledgeService inicializado (vers√£o simplificada)
2025-09-06 01:29:15.997 | INFO     | app.utils.logger:log_with_emoji:75 | üöÄ Iniciando AgenticSDR Stateless
2025-09-06 01:29:15.998 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo prim√°rio Gemini configurado pronto | Data: {'model': 'gemini-2.5-pro'}
2025-09-06 01:29:16.006 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo fallback OpenAI configurado pronto | Data: {'model': 'o3-mini'}
2025-09-06 01:29:16.006 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Modelo reasoning configurado pronto | Data: {'model': 'gemini-2.0-flash-thinking'}
2025-09-06 01:29:16.006 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Sistema de modelos configurado pronto | Data: {'primary_model': 'gemini-2.5-pro', 'fallback_available': True, 'reasoning_enabled': True}
2025-09-06 01:29:16.007 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üé® MultimodalProcessor habilitado pronto | Data: {'dependencies': {'ocr': True, 'audio': True, 'pdf': True}}
2025-09-06 01:29:16.007 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üìä LeadManager inicializado pronto
2025-09-06 01:29:16.007 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üß† ContextAnalyzer inicializado pronto
2025-09-06 01:29:16.007 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ üìä ConversationMonitor inicializado pronto
2025-09-06 01:29:16.007 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è ‚úÖ ConversationMonitor: Loop iniciado
2025-09-06 01:29:16.010 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: ‚úÖ Servi√ßo Google Calendar constru√≠do com OAuth
2025-09-06 01:29:16.276 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: Google Calendar conectado via OAuth ao calend√°rio: 'leonardofvieira00@gmail.com' | Data: {'calendar_id': 'leonardofvieira00@gmail.com'}
2025-09-06 01:29:17.130 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Kommo CRM conectado: leonardofvieira00
‚ö†Ô∏è Rate Limiter: Usando burst para kommo
2025-09-06 01:29:17.673 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 9 campos customizados mapeados
‚ö†Ô∏è Rate Limiter: Usando burst para kommo
2025-09-06 01:29:18.198 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Service: üìä 30 varia√ß√µes de est√°gios mapeadas
2025-09-06 01:29:18.227 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Service: ‚úÖ Evolution API conectada: 1 inst√¢ncias
2025-09-06 01:29:18.227 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ AgenticSDR Stateless inicializado! pronto | Data: {'modules': ['ModelManager', 'MultimodalProcessor', 'LeadManager', 'ContextAnalyzer', 'CalendarService', 'CRMService', 'FollowUpService']}
2025-09-06 01:29:18.228 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ Agente stateless criado com contexto pronto | Data: {'history_count': 21, 'lead_name': 'Mateus M'}
2025-09-06 01:29:18.228 | INFO     | app.utils.logger:log_with_emoji:75 | ‚öôÔ∏è AGENTIC SDR Stateless pronto para uso
2025-09-06 01:29:18.228 | INFO     | app.utils.logger:log_with_emoji:75 | ü§ñ AGENTIC SDR: ü§ñ AGENTE STATELESS INICIADO - Mensagem: 'oi?...'
2025-09-06 01:29:18.229 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Mensagem do usu√°rio registrada
2025-09-06 01:29:18.229 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Mensagem adicionada ao hist√≥rico. Total: 22 mensagens
2025-09-06 01:29:18.230 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Contexto analisado - Sentimento: {'enabled': True, 'sentiment': 'neutro', 'score': 0.0, 'confidence': 0.7}, Urg√™ncia: normal
2025-09-06 01:29:18.230 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Lead atualizado - Nome: 'Mateus M', Valor: 500.0
2025-09-06 01:29:18.230 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ CONTEXTO ATUALIZADO - Hist√≥rico e lead_info finalizados
2025-09-06 01:29:18.230 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Contexto atualizado - Lead: Mateus M, Hist√≥rico: 22 msgs
2025-09-06 01:29:18.231 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Sincroniza√ß√£o externa conclu√≠da
2025-09-06 01:29:18.231 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è CRM Sync: Payload de atualiza√ß√£o gerado. | Data: {'payload': {'chosen_flow': 'Compra com Desconto', 'name': 'Mateus M', 'bill_value': 500.0, 'phone': '558182986181', 'qualification_score': 40, 'tags': ['Compra com Desconto']}}
üö´ Rate Limiter: Bloqueando kommo. Aguarde 5.1s
‚è≥ Rate Limiter: Aguardando 6.1s para kommo...
‚ö†Ô∏è Rate Limiter: Usando burst para kommo
2025-09-06 01:29:24.968 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è CRM Sync: Dados do lead atualizados no Kommo. | Data: {'payload': {'chosen_flow': 'Compra com Desconto', 'name': 'Mateus M', 'bill_value': 500.0, 'phone': '558182986181', 'qualification_score': 40, 'tags': ['Compra com Desconto']}}
2025-09-06 01:29:24.968 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Dados CRM sincronizados
INFO:     10.11.0.4:37692 - "POST /webhook/kommo/events HTTP/1.1" 200 OK
2025-09-06 01:29:40.922 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Resposta LLM gerada: '<RESPOSTA_FINAL>Estou aqui sim, Mateus. Para agilizarmos, o que acha de marcarmos sua reuni√£o para s...'
2025-09-06 01:29:40.923 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Resposta do assistente registrada
2025-09-06 01:29:40.924 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ AGENTIC SUCCESS: ‚úÖ AGENTE STATELESS CONCLU√çDO - 558182986181: 'oi?...' -> '<RESPOSTA_FINAL>Estou aqui sim, Mateus. Para agili...'
2025-09-06 01:29:40.924 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Resposta gerada pelo agente: '<RESPOSTA_FINAL>Estou aqui sim, Mateus. Para agilizarmos, o que acha de marcarmos sua reuni√£o para s...'
2025-09-06 01:29:41.613 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Resposta do assistente salva
2025-09-06 01:29:41.835 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Lead atualizado
INFO:     127.0.0.1:48750 - "GET /health HTTP/1.1" 200 OK
2025-09-06 01:29:52.937 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Evolution API - Typing enviado para 558182986181 (dura√ß√£o: 5.74s, tamanho: 152)
2025-09-06 01:30:00.484 | INFO     | app.utils.logger:log_with_emoji:75 | ‚ÑπÔ∏è Evolution API - Mensagem de texto enviada para 558182986181 (tamanho: 152, delay: 5.0s)
2025-09-06 01:30:00.485 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ Resposta enviada via WhatsApp
2025-09-06 01:30:00.485 | INFO     | app.utils.logger:log_with_emoji:75 | ‚úÖ ‚úÖ PROCESSAMENTO PRINCIPAL CONCLU√çDO - 558182986181: 'oi?...' -> 'Estou aqui sim, Mateus. Para agilizarmos, o que ac...'
2025-09-06 01:30:01.215 | INFO     | app.utils.logger:log_with_emoji:75 | üìû Webhook recebido: /whatsapp/messages-update de evolution-api | Data: {'event': 'MESSAGES_UPDATE', 'endpoint': '/whatsapp/messages-update', 'source': 'evolution-api'}
INFO:     10.11.0.4:45254 - "POST /webhook/evolution/messages-update HTTP/1.1" 200 OK